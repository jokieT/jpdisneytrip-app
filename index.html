<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Êó•Êú¨ 2026 Ë°åÁ®ã App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* CSS Variables for Theme Switching */
        :root {
            --bg-color: #f0f2f5;
            --text-color: #4a5568;
            --card-bg: #e0e5ec;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --accent: #6b7c93;
            --input-bg: #e0e5ec;
        }

        [data-theme="dark"] {
            --bg-color: #292d32;
            --text-color: #a0a5a9;
            --card-bg: #292d32;
            --shadow-light: #32373d;
            --shadow-dark: #202327;
            --accent: #a0a5a9;
            --input-bg: #292d32;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans TC', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .neu-flat {
            background: var(--card-bg);
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }

        .neu-pressed {
            background: var(--card-bg);
            box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
            border-radius: 15px;
        }

        .neu-btn {
            background: var(--card-bg);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.2s ease;
            color: var(--text-color);
            cursor: pointer;
        }

        .neu-btn:active, .neu-btn.active {
            box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
            transform: translateY(1px);
        }

        .neu-input {
            background: var(--input-bg);
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            border: none;
            color: var(--text-color);
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .neu-input:focus {
            outline: none;
            box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
        }

        /* Flight Card Special Style */
        .flight-line {
            border-top: 2px dashed var(--text-color);
            opacity: 0.3;
            position: absolute;
            top: 50%;
            left: 20%;
            right: 20%;
            z-index: 0;
        }

        .modal-overlay {
            background-color: rgba(0,0,0,0.75);
            backdrop-filter: blur(4px);
        }

        select {
            -webkit-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body class="h-screen overflow-hidden select-none">

    <div id="app" class="h-full flex flex-col max-w-md mx-auto relative transition-colors duration-300">
        
        <!-- Header & Theme Toggle -->
        <header class="p-6 pb-2 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold tracking-widest">TOKYO 2026</h1>
                <p class="text-xs opacity-70">JAN 26 - JAN 31</p>
            </div>
            <button @click="toggleTheme" class="neu-btn w-10 h-10 rounded-full flex items-center justify-center text-yellow-500">
                <i :class="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
            </button>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-5 pb-28 space-y-6">

            <!-- TAB 1: SCHEDULE -->
            <section v-if="currentTab === 'schedule'" class="space-y-6">
                
                <!-- Date Selector -->
                <div class="flex overflow-x-auto space-x-4 pb-4 px-1 hide-scrollbar">
                    <div v-for="(day, index) in tripDays" :key="index" 
                         @click="selectedDayIndex = index"
                         :class="['neu-btn px-5 py-3 rounded-2xl flex-shrink-0 text-center min-w-[90px]', selectedDayIndex === index ? 'active border border-blue-400' : '']">
                        <div class="text-xs font-bold opacity-70">{{ day.weekDay }}</div>
                        <div class="text-sm font-bold">{{ day.dateShort }}</div>
                    </div>
                </div>

                <!-- Hotel Info (Editable) -->
                <div class="neu-pressed p-4 rounded-xl flex items-start gap-3">
                    <i class="fas fa-bed mt-1 opacity-50"></i>
                    <div class="w-full">
                        <input v-model="currentDay.hotel.name" placeholder="Ëº∏ÂÖ•ÈÖíÂ∫óÂêçÁ®±" class="bg-transparent w-full text-sm font-bold focus:outline-none mb-1 text-[var(--text-color)]">
                        <input v-model="currentDay.hotel.address" placeholder="Ëº∏ÂÖ•ÈÖíÂ∫óÂú∞ÂùÄ..." class="bg-transparent w-full text-xs opacity-70 focus:outline-none text-[var(--text-color)]">
                    </div>
                </div>

                <!-- Weather (Manual) -->
                <div class="neu-flat p-4 flex items-center justify-between">
                    <div>
                        <div class="text-xs opacity-50">È†êÊ∏¨Â§©Ê∞£ (ÈªûÊìä‰øÆÊîπ)</div>
                        <input v-model="currentDay.weather.temp" class="bg-transparent text-xl font-light w-16 focus:outline-none text-[var(--text-color)]">
                        <div class="text-xs opacity-70">{{ currentDay.location }}</div>
                    </div>
                    <select v-model="currentDay.weather.icon" class="bg-transparent text-3xl focus:outline-none text-right appearance-none">
                        <option>‚òÄÔ∏è</option><option>‚òÅÔ∏è</option><option>üåßÔ∏è</option><option>‚òÉÔ∏è</option>
                    </select>
                </div>

                <!-- Flight Card (Only Day 1 & Last Day) -->
                <div v-if="currentDay.flight" class="neu-flat p-5 relative overflow-hidden">
                    <div class="text-xs font-bold text-center mb-4 opacity-50 tracking-widest">FLIGHT INFO</div>
                    <div class="flex justify-between items-center relative z-10">
                        <div class="text-center">
                            <div class="text-2xl font-black">{{ currentDay.flight.from }}</div>
                            <div class="text-xs opacity-70">{{ currentDay.flight.fromTerminal }}</div>
                            <input type="time" v-model="currentDay.flight.depTime" class="bg-transparent text-xs mt-1 text-center w-full focus:outline-none text-[var(--text-color)]">
                        </div>
                        <i class="fas fa-plane text-xl opacity-50 transform rotate-90 sm:rotate-0"></i>
                        <div class="text-center">
                            <div class="text-2xl font-black">{{ currentDay.flight.to }}</div>
                            <div class="text-xs opacity-70">{{ currentDay.flight.toTerminal }}</div>
                            <input type="time" v-model="currentDay.flight.arrTime" class="bg-transparent text-xs mt-1 text-center w-full focus:outline-none text-[var(--text-color)]">
                        </div>
                    </div>
                    <div class="flight-line"></div>
                </div>

                <!-- Disney Planner -->
                <div v-if="currentDay.parkName" class="neu-flat p-5 space-y-4 border-l-4 border-purple-500">
                    <h3 class="text-sm font-bold text-purple-500 uppercase flex justify-between">
                        <span>üé° {{ currentDay.parkName === 'land' ? 'Disneyland' : 'DisneySea' }} Planner</span>
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <input type="time" v-model="tempDisney.start" class="neu-input p-2 text-xs text-center">
                        <input type="time" v-model="tempDisney.end" class="neu-input p-2 text-xs text-center">
                    </div>

                    <select v-model="tempDisney.area" class="neu-input w-full p-3 text-sm">
                        <option value="" disabled selected>1. ÈÅ∏ÊìáÂçÄÂüü</option>
                        <option v-for="area in currentParkAreas" :key="area.name" :value="area.name">{{ area.name }}</option>
                    </select>

                    <select v-if="tempDisney.area" v-model="tempDisney.facility" class="neu-input w-full p-3 text-sm">
                        <option value="" disabled selected>2. ÈÅ∏ÊìáË®≠ÊñΩ/È§êÂª≥/ÂïÜÂ∫ó</option>
                        <option v-for="item in getFacilitiesByArea(tempDisney.area)" :key="item.val" :value="item">
                            {{ item.label }}
                        </option>
                    </select>

                    <button @click="addDisneyEvent" :disabled="!tempDisney.facility" class="neu-btn w-full py-3 rounded-xl text-sm font-bold text-purple-500">
                        + Âä†ÂÖ•Ë°åÁ®ã
                    </button>
                </div>

                <!-- Custom Itinerary List -->
                <div class="space-y-4">
                    <div class="flex justify-between items-end">
                        <h3 class="text-sm font-bold ml-2 opacity-50">SCHEDULE</h3>
                        <button @click="openEventModal()" class="neu-btn px-3 py-1 text-xs rounded-lg">+ Ëá™Ë®ÇË°åÁ®ã</button>
                    </div>

                    <div v-for="(item, idx) in sortedEvents" :key="idx" class="neu-flat p-4 relative group">
                        <!-- Delete Button -->
                        <button @click="deleteEvent(idx)" class="absolute top-2 right-2 text-xs opacity-30 hover:opacity-100 text-red-500 p-2">‚úï</button>

                        <div class="flex gap-4">
                            <div class="flex flex-col items-center min-w-[60px]">
                                <div class="text-xs font-mono opacity-70">{{ item.startTime || '--:--' }}</div>
                                <div class="text-xs opacity-30">|</div>
                                <div class="text-xs font-mono opacity-70">{{ item.endTime || '' }}</div>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold text-sm">{{ item.title }}</div>
                                <div class="text-xs opacity-70 mt-1 whitespace-pre-line">{{ item.desc }}</div>
                                
                                <!-- Location & Map Actions -->
                                <div v-if="item.address || item.mapLink" class="mt-3 pt-2 border-t border-gray-500/20 flex gap-2 overflow-x-auto">
                                    <div v-if="item.address" class="text-[10px] opacity-60 flex items-center gap-1 mr-2">
                                        <i class="fas fa-map-marker-alt"></i> {{ item.address }}
                                    </div>
                                    <button v-if="item.mapLink" @click="toggleMap(idx)" class="neu-btn px-2 py-1 text-[10px] rounded flex items-center gap-1 whitespace-nowrap">
                                        <i class="fas fa-map"></i> {{ item.showMap ? 'Èö±ËóèÂú∞Âúñ' : 'È°ØÁ§∫Âú∞Âúñ' }}
                                    </button>
                                    <a v-if="item.mapLink" :href="item.mapLink" target="_blank" class="neu-btn px-2 py-1 text-[10px] rounded flex items-center gap-1 whitespace-nowrap text-blue-500">
                                        <i class="fas fa-location-arrow"></i> Â∞éËà™
                                    </a>
                                </div>

                                <!-- Embedded Map -->
                                <iframe v-if="item.showMap && item.mapLink" 
                                    class="w-full h-40 mt-2 rounded-lg opacity-80"
                                    frameborder="0" style="border:0" 
                                    :src="getEmbedUrl(item.mapLink)" allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB 2: MONEY (Ë®òÂ∏≥) -->
            <section v-if="currentTab === 'money'" class="space-y-6">
                <div class="neu-flat p-6 text-center">
                    <div class="text-xs opacity-50 mb-1">Á∏ΩÊîØÂá∫ (TOTAL)</div>
                    <div class="text-3xl font-light">¬• {{ totalSpending.toLocaleString() }}</div>
                    <div class="text-sm opacity-50 mt-1">‚âà HK$ {{ (totalSpending * exchangeRate).toFixed(1) }}</div>
                </div>

                <div class="neu-flat p-5 space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] ml-1 opacity-50">ÈáëÈ°ç (JPY)</label>
                            <input type="number" v-model="newExpense.amount" placeholder="¬•" class="neu-input w-full p-3 text-lg font-mono">
                        </div>
                        <div class="flex items-end pb-3 pl-2">
                             <span class="text-sm opacity-50">‚âà HK$ {{ (newExpense.amount * exchangeRate).toFixed(1) }}</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                             <label class="text-[10px] ml-1 opacity-50">È†ÖÁõÆ</label>
                             <input type="text" v-model="newExpense.item" placeholder="È£üÈ£Ø/Ë≥ºÁâ©..." class="neu-input w-full p-3 text-sm">
                        </div>
                        <div>
                            <label class="text-[10px] ml-1 opacity-50">ÊîØ‰ªòÊñπÂºè</label>
                            <select v-model="newExpense.method" class="neu-input w-full p-3 text-sm">
                                <option value="cash">ÁèæÈáë Cash</option>
                                <option value="card">‰ø°Áî®Âç° Card</option>
                                <option value="suica">Ë•øÁìúÂç° Suica</option>
                            </select>
                        </div>
                    </div>
                    <button @click="addOrUpdateExpense" class="neu-btn w-full py-3 rounded-xl text-sm font-bold text-green-600">
                        {{ isEditingExpense ? 'Á¢∫Ë™ç‰øÆÊîπ' : 'Á¢∫Ë™çË®òÂ∏≥' }}
                    </button>
                    <button v-if="isEditingExpense" @click="cancelEditExpense" class="text-xs w-full text-center opacity-50">ÂèñÊ∂à‰øÆÊîπ</button>
                </div>

                <div class="space-y-3 pb-10">
                    <div v-for="(exp, i) in expenses" :key="exp.id" class="neu-pressed p-4 flex justify-between items-center group relative">
                        <div>
                            <div class="text-sm font-bold">{{ exp.item }}</div>
                            <div class="text-xs opacity-50 uppercase">{{ exp.method }}</div>
                        </div>
                        <div class="text-right mr-6">
                            <div class="text-sm font-mono">¬•{{ Number(exp.amount).toLocaleString() }}</div>
                            <div class="text-xs opacity-50">HK${{ (exp.amount * exchangeRate).toFixed(1) }}</div>
                        </div>
                        <!-- Edit/Delete Actions -->
                        <div class="absolute right-2 flex flex-col gap-2">
                            <button @click="deleteExpense(exp.id)" class="text-red-400 opacity-50 hover:opacity-100"><i class="fas fa-trash text-xs"></i></button>
                            <button @click="editExpense(exp.id)" class="text-blue-400 opacity-50 hover:opacity-100"><i class="fas fa-pen text-xs"></i></button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB 3: MAP (Saved Locations) -->
            <section v-if="currentTab === 'map'" class="space-y-4">
                <div class="neu-flat p-4 aspect-video flex flex-col items-center justify-center relative overflow-hidden">
                   <div class="text-center space-y-2 z-10">
                        <i class="fas fa-map-marked-alt text-4xl opacity-50"></i>
                        <p class="text-xs opacity-70">Âú®Ê≠§È†ÅÈù¢ÂÑ≤Â≠òÂ∏∏Áî®Âú∞Èªû<br>ÈªûÊìäÂàóË°®Âç≥ÂèØÂ∞éËà™</p>
                        <a href="https://www.google.com/maps" target="_blank" class="neu-btn px-6 py-2 rounded-full text-sm inline-block mt-2">
                            ÈñãÂïü Google Maps App
                        </a>
                   </div>
                </div>
                
                <div class="neu-flat p-4 space-y-3">
                    <h3 class="text-sm font-bold opacity-50">Êñ∞Â¢ûÂú∞Èªû</h3>
                    <input v-model="newLocation.name" placeholder="Âú∞ÈªûÂêçÁ®±" class="neu-input w-full p-2 text-sm">
                    <input v-model="newLocation.url" placeholder="Google Maps URL" class="neu-input w-full p-2 text-sm">
                    <button @click="addLocation" class="neu-btn w-full py-2 rounded-lg text-sm">ÂÑ≤Â≠òÂú∞Èªû</button>
                </div>

                <div class="space-y-2">
                    <div v-for="(loc, idx) in savedLocations" :key="idx" class="neu-btn p-4 rounded-xl flex justify-between items-center">
                        <div @click="openMap(loc.url)" class="flex-1">
                            <div class="text-sm font-bold">{{ loc.name }}</div>
                        </div>
                        <div class="flex gap-3">
                            <button @click="loc.showEmbed = !loc.showEmbed" class="opacity-50"><i class="fas fa-eye"></i></button>
                            <button @click="deleteLocation(idx)" class="text-red-400 opacity-50"><i class="fas fa-trash"></i></button>
                        </div>
                        <!-- Embedded View -->
                        <div v-if="loc.showEmbed" class="w-full mt-2 absolute left-0 px-4 z-20">
                            <iframe class="w-full h-40 rounded-lg shadow-xl" :src="getEmbedUrl(loc.url)"></iframe>
                        </div>
                    </div>
                </div>
            </section>

             <!-- TAB 4: SHOPPING -->
             <section v-if="currentTab === 'shopping'" class="space-y-6">
                <div class="neu-flat p-5 space-y-4">
                    <h3 class="text-sm font-bold opacity-50 mb-2">SHOPPING LIST</h3>
                    <div class="flex gap-2">
                        <input type="text" v-model="newShoppingItem" placeholder="ÊÉ≥Ë≤∑ÁîöÈ∫º..." class="neu-input flex-1 p-3 text-sm">
                        <button @click="addShoppingItem" class="neu-btn px-4 rounded-xl text-xl">+</button>
                    </div>
                </div>

                <div class="space-y-2">
                    <div v-for="(item, i) in shoppingList" :key="i" class="neu-btn p-4 rounded-xl flex items-center justify-between group">
                        <div class="flex items-center gap-3 flex-1" @click="item.bought = !item.bought">
                            <div :class="['w-5 h-5 rounded-full border-2 border-gray-500 flex items-center justify-center', item.bought ? 'bg-gray-500' : '']">
                                <i v-if="item.bought" class="fas fa-check text-[10px] text-white"></i>
                            </div>
                            <span :class="['text-sm', item.bought ? 'line-through opacity-50' : '']">{{ item.name }}</span>
                        </div>
                        <button @click="shoppingList.splice(i, 1)" class="opacity-20 hover:opacity-100 text-red-500 p-2">‚úï</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Navigation Bar -->
        <nav class="absolute bottom-6 left-6 right-6 h-16 neu-flat flex justify-around items-center px-2 z-50 rounded-2xl">
            <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id" 
                :class="['p-3 rounded-xl transition', currentTab === tab.id ? 'text-blue-400 transform scale-110' : 'opacity-50']">
                <i :class="tab.icon + ' text-xl'"></i>
            </button>
        </nav>

        <!-- Event Modal -->
        <div v-if="showModal" class="fixed inset-0 modal-overlay z-[60] flex items-center justify-center p-4">
            <div class="neu-flat w-full max-w-sm p-6 space-y-4 bg-[var(--card-bg)]">
                <h3 class="font-bold text-lg">Ëá™Ë®ÇË°åÁ®ã</h3>
                <div class="flex gap-2">
                    <input type="time" v-model="newEvent.startTime" class="neu-input p-2 flex-1">
                    <span class="self-center">-</span>
                    <input type="time" v-model="newEvent.endTime" class="neu-input p-2 flex-1">
                </div>
                <input v-model="newEvent.title" placeholder="Ê®ôÈ°å (e.g. ÊôöÈ§ê)" class="neu-input w-full p-2">
                <textarea v-model="newEvent.desc" placeholder="ÂÇôË®ª..." class="neu-input w-full p-2 h-20"></textarea>
                <input v-model="newEvent.address" placeholder="Âú∞ÂùÄ (ÈÅ∏Â°´)" class="neu-input w-full p-2 text-xs">
                <input v-model="newEvent.mapLink" placeholder="Google Maps Link (ÈÅ∏Â°´)" class="neu-input w-full p-2 text-xs">
                
                <div class="flex gap-3 pt-2">
                    <button @click="saveCustomEvent" class="neu-btn flex-1 py-2 rounded-lg font-bold text-blue-500">ÂÑ≤Â≠ò</button>
                    <button @click="showModal = false" class="neu-btn flex-1 py-2 rounded-lg text-red-400">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;

        createApp({
            setup() {
                // --- Core State ---
                const isDarkMode = ref(true);
                const currentTab = ref('schedule');
                const selectedDayIndex = ref(0);
                const exchangeRate = 0.052;
                const showModal = ref(false);
                
                // --- Data Structure ---
                const tripDays = ref([
                    { date: '2026-01-26', dateShort: '1/26', weekDay: 'Mon', location: 'È¶ôÊ∏Ø -> Êù±‰∫¨', parkName: null, 
                      weather: { temp: '8¬∞C', icon: 'üåô' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      flight: { from: 'HKG', fromTerminal: 'T1', to: 'NRT', toTerminal: 'T2', depTime: '09:00', arrTime: '14:00' },
                      events: [] 
                    },
                    { date: '2026-01-27', dateShort: '1/27', weekDay: 'Tue', location: 'Tokyo Disneyland', parkName: 'land', 
                      weather: { temp: '6¬∞C', icon: '‚òÄÔ∏è' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      events: [] 
                    },
                    { date: '2026-01-28', dateShort: '1/28', weekDay: 'Wed', location: 'Tokyo DisneySea', parkName: 'sea', 
                      weather: { temp: '5¬∞C', icon: '‚òÅÔ∏è' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      events: [] 
                    },
                    { date: '2026-01-29', dateShort: '1/29', weekDay: 'Thu', location: 'Tokyo DisneySea', parkName: 'sea', 
                      weather: { temp: '4¬∞C', icon: 'üåßÔ∏è' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      events: [] 
                    },
                    { date: '2026-01-30', dateShort: '1/30', weekDay: 'Fri', location: 'Tokyo City', parkName: null, 
                      weather: { temp: '7¬∞C', icon: 'üå§Ô∏è' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      events: [] 
                    },
                    { date: '2026-01-31', dateShort: '1/31', weekDay: 'Sat', location: 'Êù±‰∫¨ -> È¶ôÊ∏Ø', parkName: null, 
                      weather: { temp: '9¬∞C', icon: '‚òÄÔ∏è' }, 
                      hotel: { name: '', address: '' },
                      flight: { from: 'NRT', fromTerminal: 'T2', to: 'HKG', toTerminal: 'T1', depTime: '18:00', arrTime: '22:30' },
                      events: [] 
                    },
                ]);

                // --- Disney Data (Trilingual) ---
                const disneyData = {
                    land: {
                        "World Bazaar (‰∏ñÁïåÂ∏ÇÈõÜ)": [
                            {label: "Main Street House (Â§ßË°óÊúçÂãôÊâÄ)", val: "Main Street House"}, 
                            {label: "Penny Arcade (‰æøÂ£´Êã±Âªä)", val: "Penny Arcade"},
                            {label: "Eastside Cafe (Êù±Ë°óÂíñÂï°È§êÈ§®)", val: "Eastside Cafe"}
                        ],
                        "Fantasyland (Â§¢ÂπªÊ®ÇÂúí)": [
                            {label: "Beauty and the Beast (ÁæéÂ•≥ËàáÈáéÁç∏ / ÁæéÂ•≥„Å®ÈáéÁç£)", val: "Beauty and the Beast"},
                            {label: "Pooh's Hunny Hunt (Â∞èÁÜäÁ∂≠Â∞ºÁçµËúúË®ò / „Éó„Éº„Åï„Çì„ÅÆ„Éè„Éã„Éº„Éè„É≥„Éà)", val: "Pooh's Hunny Hunt"},
                            {label: "Haunted Mansion (ÂπΩÈùàÂÖ¨È§® / „Éõ„Éº„É≥„ÉÜ„ÉÉ„Éâ„Éû„É≥„Ç∑„Éß„É≥)", val: "Haunted Mansion"}
                        ],
                        "Tomorrowland (ÊòéÊó•Ê®ÇÂúí)": [
                            {label: "Space Mountain (Â§™Á©∫Â±± / „Çπ„Éö„Éº„Çπ„Éª„Éû„Ç¶„É≥„ÉÜ„É≥)", val: "Space Mountain"},
                            {label: "Baymax Happy Ride (ÊùØÈ∫µÊ≠°Ê®ÇÊê≠ / „Éô„Ç§„Éû„ÉÉ„ÇØ„Çπ)", val: "Baymax Happy Ride"},
                            {label: "Monsters, Inc. (ÊÄ™Áç∏ÈõªÂäõÂÖ¨Âè∏ / „É¢„É≥„Çπ„Çø„Éº„Ç∫„Éª„Ç§„É≥„ÇØ)", val: "Monsters, Inc."}
                        ],
                        "Adventureland (Êé¢Èö™Ê®ÇÂúí)": [
                            {label: "Pirates of the Caribbean (Âä†ÂãíÊØîÊµ∑Áõú / „Ç´„É™„Éñ„ÅÆÊµ∑Ë≥ä)", val: "Pirates of the Caribbean"},
                            {label: "Jungle Cruise (Âè¢ÊûóÂ∑°Ëà™ / „Ç∏„É£„É≥„Ç∞„É´„ÇØ„É´„Éº„Ç∫)", val: "Jungle Cruise"}
                        ]
                    },
                    sea: {
                        "Fantasy Springs (Â§¢ÂπªÊ≥âÈÑâ)": [
                            {label: "Frozen Kingdom (ÂÜ∞Èõ™ÁéãÂúã / „Éï„É≠„Éº„Ç∫„É≥„Ç≠„É≥„Ç∞„ÉÄ„É†)", val: "Frozen Kingdom"},
                            {label: "Rapunzel's Forest (Èï∑È´ÆÂÖ¨‰∏ªÊ£ÆÊûó / „É©„Éó„É≥„ÉÑ„Çß„É´„ÅÆÊ£Æ)", val: "Rapunzel's Forest"},
                            {label: "Peter Pan's Never Land (ÂΩºÂæóÊΩòÂ§¢ÂπªÂ≥∂ / „Éî„Éº„Çø„Éº„Éë„É≥„ÅÆ„Éç„Éê„Éº„É©„É≥„Éâ)", val: "Peter Pan's Never Land"}
                        ],
                        "Mediterranean Harbor (Âú∞‰∏≠Êµ∑Ê∏ØÁÅ£)": [
                            {label: "Soaring: Fantastic Flight (Áø±ÁøîÔºöÂ§¢ÂπªÂ•áËà™ / „ÇΩ„Ç¢„É™„É≥)", val: "Soaring"},
                            {label: "Magellans (È∫•Âì≤ÂÄ´ / „Éû„Çº„É©„É≥„Ç∫)", val: "Magellans"}
                        ],
                        "American Waterfront (ÁæéÂúãÊµ∑Êø±)": [
                            {label: "Tower of Terror (È©öÈ≠ÇÂè§Â°î / „Çø„ÉØ„Éº„Éª„Ç™„Éñ„Éª„ÉÜ„É©„Éº)", val: "Tower of Terror"},
                            {label: "Toy Story Mania! (Áé©ÂÖ∑Á∏ΩÂãïÂì°ÁòãÁãÇÈÅäÊà≤Â±ã / „Éà„Ç§„Éª„Çπ„Éà„Éº„É™„Éº„Éª„Éû„Éã„Ç¢)", val: "Toy Story Mania"}
                        ],
                         "Mysterious Island (Á•ûÁßòÂ≥∂)": [
                            {label: "Journey to the Center of the Earth (Âú∞ÂøÉÊé¢Èö™‰πãÊóÖ / „Çª„É≥„Çø„Éº„Éª„Ç™„Éñ„Éª„Ç∏„Éª„Ç¢„Éº„Çπ)", val: "Journey to Center of Earth"}
                        ]
                    }
                };

                // --- Interactive Models ---
                const tempDisney = ref({ start: '', end: '', area: '', facility: null });
                const newEvent = ref({ startTime: '', endTime: '', title: '', desc: '', address: '', mapLink: '' });
                
                const expenses = ref([]);
                const newExpense = ref({ id: null, amount: '', method: 'cash', item: '' });
                const isEditingExpense = ref(false);

                const shoppingList = ref([{ name: 'Ëó•Â¶ùÂ∫óÈù¢ËÜú', bought: false }]);
                const newShoppingItem = ref('');

                const savedLocations = ref([
                    { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', url: 'https://goo.gl/maps/example', showEmbed: false }
                ]);
                const newLocation = ref({ name: '', url: '' });

                const tabs = [
                    {id: 'schedule', icon: 'fas fa-calendar-alt'},
                    {id: 'map', icon: 'fas fa-map-marked'},
                    {id: 'money', icon: 'fas fa-wallet'},
                    {id: 'shopping', icon: 'fas fa-shopping-bag'}
                ];

                // --- Computed ---
                const currentDay = computed(() => tripDays.value[selectedDayIndex.value]);
                
                const currentParkAreas = computed(() => {
                    if (!currentDay.value.parkName) return [];
                    const areas = disneyData[currentDay.value.parkName];
                    return Object.keys(areas).map(key => ({ name: key }));
                });

                const sortedEvents = computed(() => {
                    return [...currentDay.value.events].sort((a, b) => (a.startTime || '24:00').localeCompare(b.startTime || '24:00'));
                });

                const totalSpending = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));

                // --- Methods ---
                
                const toggleTheme = () => {
                    isDarkMode.value = !isDarkMode.value;
                    document.documentElement.setAttribute('data-theme', isDarkMode.value ? 'dark' : 'light');
                };

                const getFacilitiesByArea = (areaName) => {
                    if (!currentDay.value.parkName || !areaName) return [];
                    return disneyData[currentDay.value.parkName][areaName] || [];
                };

                // Add Disney Event
                const addDisneyEvent = () => {
                    if (!tempDisney.value.facility) return;
                    currentDay.value.events.push({
                        startTime: tempDisney.value.start,
                        endTime: tempDisney.value.end,
                        title: tempDisney.value.facility.label,
                        desc: `${tempDisney.value.area}`,
                        showMap: false
                    });
                    tempDisney.value = { start: '', end: '', area: '', facility: null };
                };

                // Custom Events
                const openEventModal = () => {
                    newEvent.value = { startTime: '', endTime: '', title: '', desc: '', address: '', mapLink: '' };
                    showModal.value = true;
                };

                const saveCustomEvent = () => {
                    if(!newEvent.value.title) return;
                    currentDay.value.events.push({ ...newEvent.value, showMap: false });
                    showModal.value = false;
                };

                const deleteEvent = (index) => {
                    if(confirm('Âà™Èô§Ê≠§Ë°åÁ®ã?')) currentDay.value.events.splice(index, 1);
                };

                // Map Helpers
                const getEmbedUrl = (url) => {
                    // Try to convert standard google maps url to embed url for iframe
                    // NOTE: This is a hack. Official embeds need API key. 
                    // This uses the old output=embed parameter which works for query searches usually.
                    return `https://maps.google.com/maps?q=${encodeURIComponent(url)}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
                };

                const toggleMap = (idx) => {
                    // Sort order might change index, so we find by object reference ideally, 
                    // but here we just rely on the sorted list rendering
                    // Actually safer to modify the object directly in the sorted array since it references original
                    sortedEvents.value[idx].showMap = !sortedEvents.value[idx].showMap;
                };

                // Money
                const addOrUpdateExpense = () => {
                    if (!newExpense.value.amount || !newExpense.value.item) return;
                    
                    if (isEditingExpense.value) {
                        const idx = expenses.value.findIndex(e => e.id === newExpense.value.id);
                        if(idx !== -1) expenses.value[idx] = { ...newExpense.value };
                        isEditingExpense.value = false;
                    } else {
                        expenses.value.unshift({ ...newExpense.value, id: Date.now() });
                    }
                    newExpense.value = { id: null, amount: '', method: 'cash', item: '' };
                };

                const editExpense = (id) => {
                    const exp = expenses.value.find(e => e.id === id);
                    if(exp) {
                        newExpense.value = { ...exp };
                        isEditingExpense.value = true;
                    }
                };

                const deleteExpense = (id) => {
                    if(confirm('Âà™Èô§Ê≠§Á¥ÄÈåÑ?')) expenses.value = expenses.value.filter(e => e.id !== id);
                };
                
                const cancelEditExpense = () => {
                    isEditingExpense.value = false;
                    newExpense.value = { id: null, amount: '', method: 'cash', item: '' };
                };

                // Shopping
                const addShoppingItem = () => {
                    if(newShoppingItem.value) {
                        shoppingList.value.push({ name: newShoppingItem.value, bought: false });
                        newShoppingItem.value = '';
                    }
                };

                // Saved Locations
                const addLocation = () => {
                    if(newLocation.value.name && newLocation.value.url) {
                        savedLocations.value.push({ ...newLocation.value, showEmbed: false });
                        newLocation.value = { name: '', url: '' };
                    }
                };
                const deleteLocation = (i) => savedLocations.value.splice(i, 1);
                const openMap = (url) => window.open(url, '_blank');

                // --- Persistence (LocalStorage) ---
                onMounted(() => {
                    // Load Theme
                    document.documentElement.setAttribute('data-theme', isDarkMode.value ? 'dark' : 'light');
                    
                    // Load Data
                    const savedTrip = localStorage.getItem('trip2026_days');
                    if(savedTrip) tripDays.value = JSON.parse(savedTrip);

                    const savedExp = localStorage.getItem('trip2026_expenses');
                    if(savedExp) expenses.value = JSON.parse(savedExp);

                    const savedShop = localStorage.getItem('trip2026_shop');
                    if(savedShop) shoppingList.value = JSON.parse(savedShop);

                    const savedLocs = localStorage.getItem('trip2026_locs');
                    if(savedLocs) savedLocations.value = JSON.parse(savedLocs);
                });

                // Watchers to auto-save
                watch(tripDays, (newVal) => localStorage.setItem('trip2026_days', JSON.stringify(newVal)), { deep: true });
                watch(expenses, (newVal) => localStorage.setItem('trip2026_expenses', JSON.stringify(newVal)), { deep: true });
                watch(shoppingList, (newVal) => localStorage.setItem('trip2026_shop', JSON.stringify(newVal)), { deep: true });
                watch(savedLocations, (newVal) => localStorage.setItem('trip2026_locs', JSON.stringify(newVal)), { deep: true });
                watch(isDarkMode, (newVal) => localStorage.setItem('trip2026_theme', newVal));

                return {
                    isDarkMode, toggleTheme,
                    currentTab, tabs, selectedDayIndex, tripDays, currentDay,
                    disneyData, currentParkAreas, tempDisney, getFacilitiesByArea, addDisneyEvent,
                    sortedEvents, showModal, newEvent, openEventModal, saveCustomEvent, deleteEvent,
                    expenses, newExpense, addOrUpdateExpense, editExpense, deleteExpense, isEditingExpense, cancelEditExpense,
                    shoppingList, newShoppingItem, addShoppingItem,
                    savedLocations, newLocation, addLocation, deleteLocation, openMap,
                    exchangeRate, totalSpending, toggleMap, getEmbedUrl
                };
            }
        }).mount('#app');
    </script>
</body>
</html>

