<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥æœ¬ 2026 è¡Œç¨‹ App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* CSS Variables for Theme Switching */
        :root {
            --bg-color: #f0f2f5;
            --text-color: #4a5568;
            --card-bg: #e0e5ec;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --accent: #6b7c93;
            --input-bg: #e0e5ec;
        }

        [data-theme="dark"] {
            --bg-color: #292d32;
            --text-color: #a0a5a9;
            --card-bg: #292d32;
            --shadow-light: #32373d;
            --shadow-dark: #202327;
            --accent: #a0a5a9;
            --input-bg: #292d32;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans TC', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .neu-flat {
            background: var(--card-bg);
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }

        .neu-pressed {
            background: var(--card-bg);
            box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
            border-radius: 15px;
        }

        .neu-btn {
            background: var(--card-bg);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.2s ease;
            color: var(--text-color);
            cursor: pointer;
        }

        .neu-btn:active, .neu-btn.active {
            box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
            transform: translateY(1px);
        }

        .neu-input {
            background: var(--input-bg);
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            border: none;
            color: var(--text-color);
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .neu-input:focus {
            outline: none;
            box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
        }

        .flight-line {
            border-top: 2px dashed var(--text-color);
            opacity: 0.3;
            position: absolute;
            top: 50%;
            left: 20%;
            right: 20%;
            z-index: 0;
        }

        .modal-overlay {
            background-color: rgba(0,0,0,0.85);
            backdrop-filter: blur(4px);
        }

        select {
            -webkit-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body class="h-screen overflow-hidden select-none">

    <div id="app" class="h-full flex flex-col max-w-md mx-auto relative transition-colors duration-300">
        
        <!-- Header -->
        <header class="p-6 pb-2 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold tracking-widest">TOKYO 2026</h1>
                <p class="text-xs opacity-70">JAN 26 - JAN 31</p>
            </div>
            <div class="flex gap-3">
                <button @click="showSettings = true" class="neu-btn w-10 h-10 rounded-full flex items-center justify-center opacity-70">
                    <i class="fas fa-cog"></i>
                </button>
                <button @click="toggleTheme" class="neu-btn w-10 h-10 rounded-full flex items-center justify-center text-yellow-500">
                    <i :class="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-5 pb-28 space-y-6">

            <!-- TAB 1: SCHEDULE -->
            <section v-if="currentTab === 'schedule'" class="space-y-6">
                
                <!-- Date Selector -->
                <div class="flex overflow-x-auto space-x-4 pb-4 px-1 hide-scrollbar">
                    <div v-for="(day, index) in tripDays" :key="index" 
                         @click="selectedDayIndex = index"
                         :class="['neu-btn px-5 py-3 rounded-2xl flex-shrink-0 text-center min-w-[90px]', selectedDayIndex === index ? 'active border border-blue-400' : '']">
                        <div class="text-xs font-bold opacity-70">{{ day.weekDay }}</div>
                        <div class="text-sm font-bold">{{ day.dateShort }}</div>
                    </div>
                </div>

                <!-- Hotel Info -->
                <div class="neu-pressed p-4 rounded-xl flex items-start gap-3">
                    <i class="fas fa-bed mt-1 opacity-50"></i>
                    <div class="w-full">
                        <input v-model="currentDay.hotel.name" placeholder="è¼¸å…¥é…’åº—åç¨±" class="bg-transparent w-full text-sm font-bold focus:outline-none text-[var(--text-color)]">
                        <input v-model="currentDay.hotel.address" placeholder="è¼¸å…¥é…’åº—åœ°å€..." class="bg-transparent w-full text-xs opacity-70 focus:outline-none text-[var(--text-color)]">
                    </div>
                </div>

                <!-- Weather -->
                <div class="neu-flat p-4 flex items-center justify-between">
                    <div>
                        <div class="text-xs opacity-50">é æ¸¬å¤©æ°£ (é»æ“Šä¿®æ”¹)</div>
                        <input v-model="currentDay.weather.temp" class="bg-transparent text-xl font-light w-16 focus:outline-none text-[var(--text-color)]">
                        <div class="text-xs opacity-70">{{ currentDay.location }}</div>
                    </div>
                    <select v-model="currentDay.weather.icon" class="bg-transparent text-3xl focus:outline-none text-right appearance-none">
                        <option>â˜€ï¸</option><option>â˜ï¸</option><option>ğŸŒ§ï¸</option><option>â˜ƒï¸</option>
                    </select>
                </div>

                <!-- Flight Card -->
                <div v-if="currentDay.flight" class="neu-flat p-5 relative overflow-hidden">
                    <div class="text-xs font-bold text-center mb-4 opacity-50 tracking-widest">FLIGHT INFO</div>
                    <div class="flex justify-between items-center relative z-10">
                        <div class="text-center">
                            <div class="text-2xl font-black">{{ currentDay.flight.from }}</div>
                            <div class="text-xs opacity-70">{{ currentDay.flight.fromTerminal }}</div>
                            <input type="time" v-model="currentDay.flight.depTime" class="bg-transparent text-xs mt-1 text-center w-full focus:outline-none text-[var(--text-color)]">
                        </div>
                        <i class="fas fa-plane text-xl opacity-50 transform rotate-90 sm:rotate-0"></i>
                        <div class="text-center">
                            <div class="text-2xl font-black">{{ currentDay.flight.to }}</div>
                            <div class="text-xs opacity-70">{{ currentDay.flight.toTerminal }}</div>
                            <input type="time" v-model="currentDay.flight.arrTime" class="bg-transparent text-xs mt-1 text-center w-full focus:outline-none text-[var(--text-color)]">
                        </div>
                    </div>
                    <div class="flight-line"></div>
                </div>

                <!-- Disney Planner (Updated with Chinese Areas) -->
                <div v-if="currentDay.parkName" class="neu-flat p-5 space-y-4 border-l-4 border-purple-500">
                    <h3 class="text-sm font-bold text-purple-500 uppercase flex justify-between">
                        <span>ğŸ¡ {{ currentDay.parkName === 'land' ? 'Disneyland' : 'DisneySea' }} Planner</span>
                    </h3>
                    
                    <!-- Time -->
                    <div class="grid grid-cols-2 gap-2">
                        <input type="time" v-model="tempDisney.start" class="neu-input p-2 text-xs text-center">
                        <input type="time" v-model="tempDisney.end" class="neu-input p-2 text-xs text-center">
                    </div>

                    <!-- 1. Area Selection -->
                    <select v-model="tempDisney.area" class="neu-input w-full p-3 text-sm">
                        <option value="" disabled selected>1. é¸æ“‡å€åŸŸ (Area)</option>
                        <option v-for="area in currentParkAreas" :key="area" :value="area">{{ area }}</option>
                    </select>

                    <!-- 2. Type Selection (Attraction/Food/Shop) -->
                    <select v-if="tempDisney.area" v-model="tempDisney.type" class="neu-input w-full p-3 text-sm">
                        <option value="" disabled selected>2. é¸æ“‡é¡åˆ¥ (Type)</option>
                        <option value="attractions">ğŸ¢ éŠæ¨‚è¨­æ–½ (Attractions)</option>
                        <option value="restaurants">ğŸ½ï¸ é¤å»³ (Restaurants)</option>
                        <option value="shops">ğŸ›ï¸ å•†åº— (Shops)</option>
                    </select>

                    <!-- 3. Specific Item Selection -->
                    <select v-if="tempDisney.type" v-model="tempDisney.facility" class="neu-input w-full p-3 text-sm">
                        <option value="" disabled selected>3. é¸æ“‡é …ç›®</option>
                        <option v-for="item in currentFacilityList" :key="item" :value="item">{{ item }}</option>
                    </select>
                    
                    <!-- 4. Notes -->
                    <input v-if="tempDisney.facility" v-model="tempDisney.note" placeholder="å‚™è¨» (e.g. æŠ½Pass / è²·é ­ç®)" class="neu-input w-full p-3 text-sm">

                    <button @click="addDisneyEvent" :disabled="!tempDisney.facility" class="neu-btn w-full py-3 rounded-xl text-sm font-bold text-purple-500">
                        + åŠ å…¥è¡Œç¨‹
                    </button>
                </div>

                <!-- Itinerary List -->
                <div class="space-y-4">
                    <div class="flex justify-between items-end">
                        <h3 class="text-sm font-bold ml-2 opacity-50">SCHEDULE</h3>
                        <button @click="openEventModal()" class="neu-btn px-3 py-1 text-xs rounded-lg">+ è‡ªè¨‚è¡Œç¨‹</button>
                    </div>

                    <div v-for="(item, idx) in sortedEvents" :key="idx" class="neu-flat p-4 relative group">
                        <button @click="deleteEvent(idx)" class="absolute top-2 right-2 text-xs opacity-30 hover:opacity-100 text-red-500 p-2">âœ•</button>

                        <div class="flex gap-4">
                            <div class="flex flex-col items-center min-w-[60px]">
                                <div class="text-xs font-mono opacity-70">{{ item.startTime || '--:--' }}</div>
                                <div class="text-xs opacity-30">|</div>
                                <div class="text-xs font-mono opacity-70">{{ item.endTime || '' }}</div>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold text-sm">{{ item.title }}</div>
                                <div class="text-xs opacity-70 mt-1 whitespace-pre-line">{{ item.desc }}</div>
                                <div v-if="item.note" class="text-xs text-purple-400 mt-1 bg-purple-500/10 p-1 rounded inline-block">ğŸ“ {{ item.note }}</div>
                                
                                <div v-if="item.address || item.mapLink" class="mt-3 pt-2 border-t border-gray-500/20 flex gap-2 overflow-x-auto">
                                    <button v-if="item.mapLink" @click="toggleMap(idx)" class="neu-btn px-2 py-1 text-[10px] rounded flex items-center gap-1 whitespace-nowrap">
                                        <i class="fas fa-map"></i> {{ item.showMap ? 'éš±è—' : 'åœ°åœ–' }}
                                    </button>
                                    <a v-if="item.mapLink" :href="item.mapLink" target="_blank" class="neu-btn px-2 py-1 text-[10px] rounded flex items-center gap-1 whitespace-nowrap text-blue-500">
                                        <i class="fas fa-location-arrow"></i> å°èˆª
                                    </a>
                                </div>
                                <iframe v-if="item.showMap && item.mapLink" class="w-full h-40 mt-2 rounded-lg opacity-80" frameborder="0" style="border:0" :src="getEmbedUrl(item.mapLink)"></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB 2: MONEY -->
            <section v-if="currentTab === 'money'" class="space-y-6">
                 <div class="neu-flat p-6 text-center">
                    <div class="text-xs opacity-50 mb-1">ç¸½æ”¯å‡º (TOTAL)</div>
                    <div class="text-3xl font-light">Â¥ {{ totalSpending.toLocaleString() }}</div>
                    <div class="text-sm opacity-50 mt-1">â‰ˆ HK$ {{ (totalSpending * exchangeRate).toFixed(1) }}</div>
                </div>
                <div class="neu-flat p-5 space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-[10px] ml-1 opacity-50">é‡‘é¡</label><input type="number" v-model="newExpense.amount" class="neu-input w-full p-3 text-lg font-mono"></div>
                        <div class="flex items-end pb-3 pl-2"><span class="text-sm opacity-50">â‰ˆ HK$ {{ (newExpense.amount * exchangeRate).toFixed(1) }}</span></div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-[10px] ml-1 opacity-50">é …ç›®</label><input type="text" v-model="newExpense.item" class="neu-input w-full p-3 text-sm"></div>
                        <div><label class="text-[10px] ml-1 opacity-50">æ”¯ä»˜</label><select v-model="newExpense.method" class="neu-input w-full p-3 text-sm"><option value="cash">ç¾é‡‘</option><option value="card">ä¿¡ç”¨å¡</option><option value="suica">Suica</option></select></div>
                    </div>
                    <button @click="addOrUpdateExpense" class="neu-btn w-full py-3 rounded-xl text-sm font-bold text-green-600">{{ isEditingExpense ? 'ä¿®æ”¹' : 'è¨˜å¸³' }}</button>
                    <button v-if="isEditingExpense" @click="cancelEditExpense" class="text-xs w-full text-center opacity-50">å–æ¶ˆ</button>
                </div>
                <div class="space-y-3 pb-10">
                    <div v-for="(exp, i) in expenses" :key="exp.id" class="neu-pressed p-4 flex justify-between items-center group relative">
                        <div><div class="text-sm font-bold">{{ exp.item }}</div><div class="text-xs opacity-50 uppercase">{{ exp.method }}</div></div>
                        <div class="text-right mr-6"><div class="text-sm font-mono">Â¥{{ Number(exp.amount).toLocaleString() }}</div></div>
                        <div class="absolute right-2 flex flex-col gap-2">
                            <button @click="deleteExpense(exp.id)" class="text-red-400 opacity-50"><i class="fas fa-trash text-xs"></i></button>
                            <button @click="editExpense(exp.id)" class="text-blue-400 opacity-50"><i class="fas fa-pen text-xs"></i></button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB 3: MAP -->
            <section v-if="currentTab === 'map'" class="space-y-4">
                 <div class="neu-flat p-4 space-y-3">
                    <h3 class="text-sm font-bold opacity-50">æ–°å¢åœ°é»</h3>
                    <input v-model="newLocation.name" placeholder="åœ°é»åç¨±" class="neu-input w-full p-2 text-sm">
                    <input v-model="newLocation.url" placeholder="Google Maps URL" class="neu-input w-full p-2 text-sm">
                    <button @click="addLocation" class="neu-btn w-full py-2 rounded-lg text-sm">å„²å­˜åœ°é»</button>
                </div>
                <div class="space-y-2">
                    <div v-for="(loc, idx) in savedLocations" :key="idx" class="neu-btn p-4 rounded-xl flex justify-between items-center">
                        <div @click="openMap(loc.url)" class="flex-1"><div class="text-sm font-bold">{{ loc.name }}</div></div>
                        <div class="flex gap-3"><button @click="loc.showEmbed = !loc.showEmbed" class="opacity-50"><i class="fas fa-eye"></i></button><button @click="deleteLocation(idx)" class="text-red-400 opacity-50"><i class="fas fa-trash"></i></button></div>
                        <div v-if="loc.showEmbed" class="w-full mt-2 absolute left-0 px-4 z-20"><iframe class="w-full h-40 rounded-lg shadow-xl" :src="getEmbedUrl(loc.url)"></iframe></div>
                    </div>
                </div>
            </section>

             <!-- TAB 4: SHOPPING -->
             <section v-if="currentTab === 'shopping'" class="space-y-6">
                <div class="neu-flat p-5 space-y-4"><div class="flex gap-2"><input type="text" v-model="newShoppingItem" class="neu-input flex-1 p-3 text-sm"><button @click="addShoppingItem" class="neu-btn px-4 rounded-xl text-xl">+</button></div></div>
                <div class="space-y-2"><div v-for="(item, i) in shoppingList" :key="i" class="neu-btn p-4 rounded-xl flex items-center justify-between"><div class="flex items-center gap-3 flex-1" @click="item.bought = !item.bought"><div :class="['w-5 h-5 rounded-full border-2 border-gray-500 flex items-center justify-center', item.bought ? 'bg-gray-500' : '']"><i v-if="item.bought" class="fas fa-check text-[10px] text-white"></i></div><span :class="['text-sm', item.bought ? 'line-through opacity-50' : '']">{{ item.name }}</span></div><button @click="shoppingList.splice(i, 1)" class="opacity-20 text-red-500 p-2">âœ•</button></div></div>
            </section>
        </main>

        <!-- Navigation Bar -->
        <nav class="absolute bottom-6 left-6 right-6 h-16 neu-flat flex justify-around items-center px-2 z-50 rounded-2xl">
            <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id" :class="['p-3 rounded-xl transition', currentTab === tab.id ? 'text-blue-400 transform scale-110' : 'opacity-50']"><i :class="tab.icon + ' text-xl'"></i></button>
        </nav>
        
        <!-- Add Event Modal -->
        <div v-if="showModal" class="fixed inset-0 modal-overlay z-[60] flex items-center justify-center p-4">
            <div class="neu-flat w-full max-w-sm p-6 space-y-4 bg-[var(--card-bg)]">
                <h3 class="font-bold text-lg">è‡ªè¨‚è¡Œç¨‹</h3>
                <div class="flex gap-2"><input type="time" v-model="newEvent.startTime" class="neu-input p-2 flex-1"><input type="time" v-model="newEvent.endTime" class="neu-input p-2 flex-1"></div>
                <input v-model="newEvent.title" placeholder="æ¨™é¡Œ" class="neu-input w-full p-2">
                <textarea v-model="newEvent.desc" placeholder="è©³æƒ…" class="neu-input w-full p-2 h-20"></textarea>
                <input v-model="newEvent.note" placeholder="å‚™è¨» (ç´«è‰²æ¨™ç±¤)" class="neu-input w-full p-2 text-xs">
                <input v-model="newEvent.mapLink" placeholder="Maps Link" class="neu-input w-full p-2 text-xs">
                <div class="flex gap-3 pt-2"><button @click="saveCustomEvent" class="neu-btn flex-1 py-2 rounded-lg font-bold text-blue-500">å„²å­˜</button><button @click="showModal = false" class="neu-btn flex-1 py-2 rounded-lg text-red-400">å–æ¶ˆ</button></div>
            </div>
        </div>

        <!-- Settings/Sync Modal -->
        <div v-if="showSettings" class="fixed inset-0 modal-overlay z-[70] flex items-center justify-center p-4">
            <div class="neu-flat w-full max-w-sm p-6 space-y-4 bg-[var(--card-bg)]">
                <h3 class="font-bold text-lg mb-2">æ•¸æ“šåŒæ­¥ (Data Sync)</h3>
                
                <div class="space-y-2">
                    <p class="text-xs opacity-70">1. é»æ“Šã€ŒåŒ¯å‡ºã€ï¼Œè¤‡è£½ä»£ç¢¼å‚³çµ¦å®¶äººã€‚</p>
                    <button @click="exportData" class="neu-btn w-full py-2 rounded text-sm text-blue-400">ğŸ“‹ è¤‡è£½åŒ¯å‡ºä»£ç¢¼ (Copy Export)</button>
                </div>
                
                <hr class="border-gray-500/20">

                <div class="space-y-2">
                    <p class="text-xs opacity-70">2. å®¶äººåœ¨æ­¤è²¼ä¸Šä»£ç¢¼ï¼Œé»æ“Šã€ŒåŒ¯å…¥ã€ã€‚</p>
                    <textarea v-model="importString" placeholder="åœ¨æ­¤è²¼ä¸Šä»£ç¢¼..." class="neu-input w-full h-24 p-2 text-[10px] font-mono"></textarea>
                    <button @click="importData" class="neu-btn w-full py-2 rounded text-sm text-green-500">ğŸ“¥ ç¢ºèªåŒ¯å…¥ (Import)</button>
                </div>

                <div class="pt-4">
                    <button @click="showSettings = false" class="neu-btn w-full py-2 rounded-lg text-red-400">é—œé–‰</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;

        // Expanded Disney Data Source with Chinese Translations
        const disneyDB = {
            land: {
                "World Bazaar (ä¸–ç•Œå¸‚é›†)": {
                    attractions: ["Omnibus (é›™å±¤å·´å£«)", "Penny Arcade (ä¾¿å£«æ‹±å»Š)"],
                    restaurants: ["Eastside Cafe (æ±è¡—å’–å•¡é¤é¤¨)", "Center Street Coffeehouse (ä¸­å¤®å¤§é“å’–å•¡é¤é¤¨)", "Great American Waffle Co. (æœ€ä½³ç¾åœ‹é¬†é¤…å…¬å¸)", "Restaurant Hokusai (åŒ—é½‹é¤å»³)", "Sweetheart Cafe (ç”œå¿ƒå’–å•¡é¤é¤¨)"],
                    shops: ["Grand Emporium (æ ¼è˜­æ©æ³¢å•†å ´)", "World Bazaar Confectionery (ä¸–ç•Œå¸‚é›†é»å¿ƒåŠ)", "House of Greetings (è‡´è³€å±‹)"]
                },
                "Adventureland (æ¢éšªæ¨‚åœ’)": {
                    attractions: ["Pirates of the Caribbean (åŠ å‹’æ¯”æµ·ç›œ)", "Jungle Cruise (å¢æ—å·¡èˆª)", "Western River Railroad (è¥¿éƒ¨æ²¿æ²³éµè·¯)", "The Enchanted Tiki Room (æåŸºç¥æ®¿)"],
                    restaurants: ["Blue Bayou Restaurant (è—æµ·ç£é¤å»³)", "Crystal Palace Restaurant (æ°´æ™¶å®®é¤å»³)", "Polynesian Terrace (æ³¢åˆ©å°¼è¥¿äºè‰å£‡é¤å»³)", "China Voyager (ä¸­è¯é¤å»³)", "Cafe Orleans (å¥§çˆ¾è‰¯å’–å•¡)"],
                    shops: ["Adventureland Bazaar (æ¢éšªæ¨‚åœ’å¸‚é›†)", "Le Marche Bleu (è—è‰²å¸‚é›†)", "Cristal Arts (æ°´æ™¶è—è¡“)"]
                },
                "Westernland (è¥¿éƒ¨æ¨‚åœ’)": {
                    attractions: ["Big Thunder Mountain (å·¨é›·å±±)", "Country Bear Theater (é„‰æ‘é ‘ç†ŠåŠ‡å ´)", "Mark Twain Riverboat (é¦¬å…‹åæº«è™Ÿ)", "Tom Sawyer Island (æ¹¯å§†ç´¢äºå³¶)"],
                    restaurants: ["Hungry Bear Restaurant (é ‘ç†Šé¤å»³)", "Plaza Pavilion Restaurant (å»£å ´æ¨“é–£é¤å»³)", "Pecos Bill Cafe (ä½©æ–¯æ¯”çˆ¾å°é¤¨)", "Camp Woodchuck Kitchen (åœŸæ’¥é¼ ç‡Ÿåœ°å»šæˆ¿)"],
                    shops: ["Western Wear (è¥¿éƒ¨æœè£)", "General Store (é›œè²¨åº—)"]
                },
                "Critter Country (å‹•ç‰©å¤©åœ°)": {
                    attractions: ["Splash Mountain (é£›æ¿ºå±±)", "Beaver Brothers Explorer Canoes (æµ·è²å…„å¼Ÿç¨æœ¨èˆŸ)"],
                    restaurants: ["Grandma Sara's Kitchen (èæ‹‰é˜¿å¥¶å¥¶çš„å»šæˆ¿)", "Rackety's Raccoon Saloon (æ‹‰å‰è’‚æµ£ç†Šå°ç«™)"],
                    shops: ["Hoot & Holler Hideout (å‘¼å—’Â·èµ«å‹’çª©)"]
                },
                "Fantasyland (å¤¢å¹»æ¨‚åœ’)": {
                    attractions: ["Enchanted Tale of Beauty and the Beast (ç¾å¥³èˆ‡é‡ç¸)", "Pooh's Hunny Hunt (å°ç†Šç¶­å°¼çµèœœè¨˜)", "Haunted Mansion (å¹½éˆå…¬é¤¨)", "It's a Small World (å°å°ä¸–ç•Œ)", "Peter Pan's Flight (å½¼å¾—æ½˜)", "Pinocchio's Daring Journey (å°æœ¨å¶å¥‡é‡è¨˜)", "Snow White's Adventures (ç™½é›ªå…¬ä¸»å†’éšªæ—…ç¨‹)", "Dumbo (å°é£›è±¡)", "Cinderella's Fairy Tale Hall (ä»™å±¥å¥‡ç·£ç«¥è©±å¤§å»³)"],
                    restaurants: ["Queen of Hearts Banquet Hall (ç´…å¿ƒå¥³ç‹å®´æœƒå¤§å»³)", "La Taverne de Gaston (åŠ æ–¯é “é…’é¤¨)", "Captain Hook's Galley (è™å…‹èˆ¹é•·çš„å»šæˆ¿)", "Village Pastry (é„‰æ‘ç³•é»)"],
                    shops: ["Village Shoppes (é„‰æ‘å•†åº—)", "Kingdom Treasures (ç‹åœ‹å¯¶è—)", "Pooh Corner (å°ç†Šç¶­å°¼å°ˆæ«ƒ)"]
                },
                "Toontown (å¡é€šåŸ)": {
                    attractions: ["Roger Rabbit's Car Toon Spin (ç¾…å‚‘å…”å­è½‰è½‰è»Š)", "Minnie's Style Studio (ç±³å¦®æ™‚å°šå·¥ä½œå®¤)", "Gadget's Go Coaster (è‰¾èŠè¿·ä½ é›²éœ„é£›è»Š)"],
                    restaurants: ["Huey, Dewey and Louie's Good Time Cafe (è¼å…’æœå…’è·¯å…’å¥½æ™‚å…‰å’–å•¡)", "Toontone Treats (å¡é€šæ¼†å½©é»å¿ƒ)"],
                    shops: ["Gag Factory (æ»‘ç¨½å·¥å» )"]
                },
                "Tomorrowland (æ˜æ—¥æ¨‚åœ’)": {
                    attractions: ["Space Mountain (å¤ªç©ºå±±)", "Star Tours (æ˜Ÿéš›æ—…è¡Œ)", "Monsters, Inc. Ride & Go Seek! (æ€ªç¸é›»åŠ›å…¬å¸)", "Baymax Happy Ride (æ¯éºµæ­¡æ¨‚æ­)", "Buzz Lightyear's Astro Blasters (å·´æ–¯å…‰å¹´æ˜Ÿéš›æ­·éšª)"],
                    restaurants: ["Pan Galactic Pizza Port (æ±éŠ€æ²³æŠ«è–©æ¸¯)", "Plazma Ray's Diner (ç‘æ–¯ç‘ªå°„ç·šå¿«é¤)", "The Big Pop (éœ¹é‚å•ªå•¦çˆ†ç±³èŠ±)"],
                    shops: ["Planet M (è¡Œæ˜ŸM)", "Cosmic Encounter (å®‡å®™ç›¸é‡)"]
                }
            },
            sea: {
                "Fantasy Springs (å¤¢å¹»æ³‰é„‰)": {
                    attractions: ["Anna and Elsa's Frozen Journey (å®‰å¨œèˆ‡è‰¾èçš„å†°é›ªä¹‹æ—…)", "Rapunzel's Lantern Festival (æ¨‚ä½©å…¬ä¸»å¤©ç‡ˆç››æœƒ)", "Peter Pan's Never Land Adventure (å½¼å¾—æ½˜å¤¢å¹»å³¶æ­·éšªè¨˜)", "Fairy Tinker Bell's Busy Buggies (å¥‡å¦™ä»™å­å¦™å¦™è»Š)"],
                    restaurants: ["Royal Banquet of Arendelle (è‰¾å€«æˆ´çˆ¾çš‡å®¶å®´æœƒå»³)", "The Snuggly Duckling (é†œå°é´¨å°é¤¨)", "Lookout Cookout (ç­æœ›è‡ºé‡é¤å±‹)"],
                    shops: ["Fantasy Springs Gifts (å¤¢å¹»æ³‰é„‰ç¦®å“)"]
                },
                "Mediterranean Harbor (åœ°ä¸­æµ·æ¸¯ç£)": {
                    attractions: ["Soaring: Fantastic Flight (ç¿±ç¿”ï¼šå¤¢å¹»å¥‡èˆª)", "DisneySea Transit Steamer Line (è¿ªå£«å°¼æµ·æ´‹æ¸¡è¼ª)", "Fortress Explorations (è¦å¡æ¢éšª)", "Venetian Gondolas (å¨å°¼æ–¯è²¢å¤šæ‹‰éŠèˆ¹)"],
                    restaurants: ["Magellan's (éº¥å“²å€«)", "Ristorante di Canaletto (å¡ç´é›·æ‰˜é¤å»³)", "Zambini Brothers' Ristorante (å°šæ¯”å°¼å…„å¼Ÿé¤å»³)", "Cafe Portofino (æ³¢å¤šè²è«¾å’–å•¡)"],
                    shops: ["Emporio (æ©æ³¢åˆ©æ­)", "Il Postino Stationery (éƒµå±€æ–‡å…·åº—)"]
                },
                "American Waterfront (ç¾åœ‹æµ·æ¿±)": {
                    attractions: ["Tower of Terror (é©šé­‚å¤å¡”)", "Toy Story Mania! (ç©å…·ç¸½å‹•å“¡ç˜‹ç‹‚éŠæˆ²å±‹)", "Turtle Talk (é¾œé¾œæ¼«è«‡)", "Big City Vehicles (å¤§éƒ½æœƒäº¤é€šå·¥å…·)"],
                    restaurants: ["S.S. Columbia Dining Room (S.S.å“¥å€«æ¯”äºé¤å»³)", "Teddy Roosevelt Lounge (æ³°è¿ªç¾…æ–¯ç¦æ­¡è…¾)", "New York Deli (ç´ç´„ç¾å‘³æˆ¿)", "Cape Cod Cook-Off (é±ˆé­šå²¬éŒ¦æ¨™ç¾é£Ÿ)"],
                    shops: ["McDuck's Department Store (å²é«˜æ²»ç™¾è²¨å…¬å¸)", "Steamboat Mickey's (è’¸æ°£èˆ¹ç±³å¥‡)"]
                },
                "Port Discovery (ç™¼ç¾æ¸¯)": {
                    attractions: ["Nemo & Friends SeaRider (å°¼è«&å¥½å‹çš„æµ·æ´‹ä¸–ç•Œ)", "Aquatopia (æ°´ä¸Šé€—è¶£èˆ¹)"],
                    restaurants: ["Horizon Bay Restaurant (æ°´å¹³ç·šæµ·ç£é¤å»³)", "Seaside Snacks (æµ·é‚Šå°åƒ)"],
                    shops: ["Discovery Gifts (ç™¼ç¾ç¦®å“)"]
                },
                "Lost River Delta (å¤±è½æ²³ä¸‰è§’æ´²)": {
                    attractions: ["Indiana Jones Adventure (å°ç¬¬å®‰ç´ç“Šæ–¯å†’éšªæ—…ç¨‹)", "Raging Spirits (å¿¿æ€’é›™ç¥)"],
                    restaurants: ["Yucatan Base Camp Grill (çŒ¶åŠ æ•¦åŸºåœ°ç‡Ÿç‡’çƒ¤)", "Miguel's El Dorado Cantina (ç±³æ ¼å‹’é»ƒé‡‘åœ‹å¿«é¤åº—)"],
                    shops: ["Lost River Outfitters (å¤±è½æ²³æ¢éšªç”¨å“)"]
                },
                "Arabian Coast (é˜¿æ‹‰ä¼¯æµ·å²¸)": {
                    attractions: ["Sinbad's Storybook Voyage (è¾›å·´é”å‚³å¥‡ä¹‹æ—…)", "The Magic Lamp Theater (ç¥ç‡ˆåŠ‡å ´)", "Jasmine's Flying Carpets (èŒ‰è‰å…¬ä¸»çš„é£›å¤©é­”æ¯¯)", "Caravan Carousel (æ²™æ¼ å•†éšŠæ—‹è½‰æœ¨é¦¬)"],
                    restaurants: ["Casbah Food Court (å¡æ–¯å·´ç¾é£Ÿå»£å ´)", "Sultan's Oasis (è˜‡ä¸¹ç¶ æ´²)"],
                    shops: ["Agrabah Marketplace (é˜¿æ ¼æ‹‰å·´å¸‚å ´)"]
                },
                "Mermaid Lagoon (ç¾äººé­šç¤æ¹–)": {
                    attractions: ["Mermaid Lagoon Theater (ç¾äººé­šç¤æ¹–åŠ‡å ´)", "Flounder's Flying Fish Coaster (å°èƒ–çš„é£›é­šé›²éœ„é£›è»Š)", "Scuttle's Scooters (å²å¡æ‰˜çš„å¯„å±…èŸ¹)", "Jumpin' Jellyfish (è·³èºæ°´æ¯)", "Blowfish Balloon Race (æ²³è±šæ°£çƒç«¶è³½)", "The Whirlpool (æ—‹è½‰æµ·è—»æ¯)"],
                    restaurants: ["Sebastian's Calypso Kitchen (è³½å·´æ–¯ä¸åŠ åŠ›éªšå»šæˆ¿)"],
                    shops: ["Sleepy Whale Shoppe (ç¡é¯¨å•†åº—)", "Kiss de Girl Fashions (å»ä¹‹å¥³å­©æœé£¾)"]
                },
                "Mysterious Island (ç¥ç§˜å³¶)": {
                    attractions: ["Journey to the Center of the Earth (åœ°å¿ƒæ¢éšªä¹‹æ—…)", "20,000 Leagues Under the Sea (æµ·åº•å…©è¬å“©)"],
                    restaurants: ["Vulcania Restaurant (ç«å±±é¤å»³)", "Nautilus Galley (é¸šéµ¡èºè™Ÿå¤§é£Ÿå ‚)"],
                    shops: ["Nautilus Gifts (é¸šéµ¡èºè™Ÿç¦®å“)"]
                }
            }
        };

        createApp({
            setup() {
                // --- Core State ---
                const isDarkMode = ref(true);
                const currentTab = ref('schedule');
                const selectedDayIndex = ref(0);
                const exchangeRate = 0.052;
                const showModal = ref(false);
                const showSettings = ref(false);
                const importString = ref('');
                
                // --- Data Structure ---
                const tripDays = ref([
                    { date: '2026-01-26', dateShort: '1/26', weekDay: 'Mon', location: 'é¦™æ¸¯ -> æ±äº¬', parkName: null, 
                      weather: { temp: '8Â°C', icon: 'ğŸŒ™' }, 
                      hotel: { name: 'æ–°å®¿æ ¼æ‹‰æ–¯éº—é…’åº—', address: '1-19-1 Kabukicho' },
                      flight: { from: 'HKG', fromTerminal: 'T1', to: 'NRT', toTerminal: 'T2', depTime: '09:00', arrTime: '14:00' },
                      events: [] },
                    { date: '2026-01-27', dateShort: '1/27', weekDay: 'Tue', location: 'Tokyo Disneyland', parkName: 'land', 
                      weather: { temp: '6Â°C', icon: 'â˜€ï¸' }, 
                      hotel: { name: 'æ–°å®¿æ ¼æ‹‰æ–¯éº—é…’åº—', address: '1-19-1 Kabukicho' },
                      events: [] },
                    { date: '2026-01-28', dateShort: '1/28', weekDay: 'Wed', location: 'Tokyo DisneySea', parkName: 'sea', 
                      weather: { temp: '5Â°C', icon: 'â˜ï¸' }, 
                      hotel: { name: 'æ–°å®¿æ ¼æ‹‰æ–¯éº—é…’åº—', address: '1-19-1 Kabukicho' },
                      events: [] },
                    { date: '2026-01-29', dateShort: '1/29', weekDay: 'Thu', location: 'Tokyo DisneySea', parkName: 'sea', 
                      weather: { temp: '4Â°C', icon: 'ğŸŒ§ï¸' }, 
                      hotel: { name: 'æ–°å®¿æ ¼æ‹‰æ–¯éº—é…’åº—', address: '1-19-1 Kabukicho' },
                      events: [] },
                    { date: '2026-01-30', dateShort: '1/30', weekDay: 'Fri', location: 'Tokyo City', parkName: null, 
                      weather: { temp: '7Â°C', icon: 'ğŸŒ¤ï¸' }, 
                      hotel: { name: 'æ–°å®¿æ ¼æ‹‰æ–¯éº—é…’åº—', address: '1-19-1 Kabukicho' },
                      events: [] },
                    { date: '2026-01-31', dateShort: '1/31', weekDay: 'Sat', location: 'æ±äº¬ -> é¦™æ¸¯', parkName: null, 
                      weather: { temp: '9Â°C', icon: 'â˜€ï¸' }, 
                      hotel: { name: '', address: '' },
                      flight: { from: 'NRT', fromTerminal: 'T2', to: 'HKG', toTerminal: 'T1', depTime: '18:00', arrTime: '22:30' },
                      events: [] },
                ]);

                const tempDisney = ref({ start: '', end: '', area: '', type: '', facility: '', note: '' });
                const newEvent = ref({ startTime: '', endTime: '', title: '', desc: '', note: '', mapLink: '' });
                const expenses = ref([]);
                const newExpense = ref({ id: null, amount: '', method: 'cash', item: '' });
                const isEditingExpense = ref(false);
                const shoppingList = ref([{ name: 'è—¥å¦åº—é¢è†œ', bought: false }]);
                const newShoppingItem = ref('');
                const savedLocations = ref([{ name: 'æ–°å®¿æ ¼æ‹‰æ–¯éº—é…’åº—', url: 'https://goo.gl/maps/example', showEmbed: false }]);
                const newLocation = ref({ name: '', url: '' });

                const tabs = [
                    {id: 'schedule', icon: 'fas fa-calendar-alt'},
                    {id: 'map', icon: 'fas fa-map-marked'},
                    {id: 'money', icon: 'fas fa-wallet'},
                    {id: 'shopping', icon: 'fas fa-shopping-bag'}
                ];

                // --- Computed ---
                const currentDay = computed(() => tripDays.value[selectedDayIndex.value]);
                
                const currentParkAreas = computed(() => {
                    if (!currentDay.value.parkName) return [];
                    return Object.keys(disneyDB[currentDay.value.parkName]);
                });

                const currentFacilityList = computed(() => {
                    if (!tempDisney.value.area || !tempDisney.value.type) return [];
                    return disneyDB[currentDay.value.parkName][tempDisney.value.area][tempDisney.value.type] || [];
                });

                const sortedEvents = computed(() => {
                    return [...currentDay.value.events].sort((a, b) => (a.startTime || '24:00').localeCompare(b.startTime || '24:00'));
                });

                const totalSpending = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));

                // --- Methods ---
                const toggleTheme = () => {
                    isDarkMode.value = !isDarkMode.value;
                    document.documentElement.setAttribute('data-theme', isDarkMode.value ? 'dark' : 'light');
                };

                const addDisneyEvent = () => {
                    if (!tempDisney.value.facility) return;
                    currentDay.value.events.push({
                        startTime: tempDisney.value.start,
                        endTime: tempDisney.value.end,
                        title: tempDisney.value.facility,
                        desc: `${tempDisney.value.area} - ${tempDisney.value.type}`,
                        note: tempDisney.value.note,
                        showMap: false
                    });
                    tempDisney.value = { start: '', end: '', area: '', type: '', facility: '', note: '' };
                };

                const openEventModal = () => {
                    newEvent.value = { startTime: '', endTime: '', title: '', desc: '', note: '', mapLink: '' };
                    showModal.value = true;
                };

                const saveCustomEvent = () => {
                    if(!newEvent.value.title) return;
                    currentDay.value.events.push({ ...newEvent.value, showMap: false });
                    showModal.value = false;
                };

                const deleteEvent = (index) => {
                    if(confirm('åˆªé™¤æ­¤è¡Œç¨‹?')) currentDay.value.events.splice(index, 1);
                };

                const getEmbedUrl = (url) => `https://maps.google.com/maps?q=${encodeURIComponent(url)}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
                const toggleMap = (idx) => sortedEvents.value[idx].showMap = !sortedEvents.value[idx].showMap;

                const addOrUpdateExpense = () => {
                    if (!newExpense.value.amount || !newExpense.value.item) return;
                    if (isEditingExpense.value) {
                        const idx = expenses.value.findIndex(e => e.id === newExpense.value.id);
                        if(idx !== -1) expenses.value[idx] = { ...newExpense.value };
                        isEditingExpense.value = false;
                    } else {
                        expenses.value.unshift({ ...newExpense.value, id: Date.now() });
                    }
                    newExpense.value = { id: null, amount: '', method: 'cash', item: '' };
                };

                const editExpense = (id) => {
                    const exp = expenses.value.find(e => e.id === id);
                    if(exp) { newExpense.value = { ...exp }; isEditingExpense.value = true; }
                };

                const deleteExpense = (id) => { if(confirm('åˆªé™¤?')) expenses.value = expenses.value.filter(e => e.id !== id); };
                const cancelEditExpense = () => { isEditingExpense.value = false; newExpense.value = { id: null, amount: '', method: 'cash', item: '' }; };
                
                const addShoppingItem = () => { if(newShoppingItem.value) { shoppingList.value.push({ name: newShoppingItem.value, bought: false }); newShoppingItem.value = ''; }};
                const addLocation = () => { if(newLocation.value.name && newLocation.value.url) { savedLocations.value.push({ ...newLocation.value, showEmbed: false }); newLocation.value = { name: '', url: '' }; }};
                const deleteLocation = (i) => savedLocations.value.splice(i, 1);
                const openMap = (url) => window.open(url, '_blank');

                // --- Sync Features ---
                const exportData = () => {
                    const allData = {
                        days: tripDays.value,
                        expenses: expenses.value,
                        shop: shoppingList.value,
                        locs: savedLocations.value
                    };
                    const jsonString = JSON.stringify(allData);
                    // Simple hash to make it look like a token, base64
                    const encoded = btoa(unescape(encodeURIComponent(jsonString)));
                    
                    navigator.clipboard.writeText(encoded).then(() => {
                        alert('ä»£ç¢¼å·²è¤‡è£½ï¼è«‹å‚³é€çµ¦å®¶äººã€‚');
                    }).catch(err => {
                        console.error(err);
                        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
                    });
                };

                const importData = () => {
                    if(!importString.value) return;
                    try {
                        const decoded = decodeURIComponent(escape(atob(importString.value)));
                        const data = JSON.parse(decoded);
                        
                        if(confirm('è­¦å‘Šï¼šé€™å°‡è¦†è“‹æ‚¨ç›®å‰æ‰€æœ‰çš„è³‡æ–™ï¼Œç¢ºå®šå—ï¼Ÿ')) {
                            if(data.days) tripDays.value = data.days;
                            if(data.expenses) expenses.value = data.expenses;
                            if(data.shop) shoppingList.value = data.shop;
                            if(data.locs) savedLocations.value = data.locs;
                            
                            alert('è³‡æ–™åŒ¯å…¥æˆåŠŸï¼');
                            showSettings.value = false;
                            importString.value = '';
                        }
                    } catch (e) {
                        alert('ä»£ç¢¼æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æ˜¯å¦è¤‡è£½å®Œæ•´ã€‚');
                        console.error(e);
                    }
                };

                onMounted(() => {
                    document.documentElement.setAttribute('data-theme', isDarkMode.value ? 'dark' : 'light');
                    if(localStorage.getItem('trip2026_days')) tripDays.value = JSON.parse(localStorage.getItem('trip2026_days'));
                    if(localStorage.getItem('trip2026_expenses')) expenses.value = JSON.parse(localStorage.getItem('trip2026_expenses'));
                    if(localStorage.getItem('trip2026_shop')) shoppingList.value = JSON.parse(localStorage.getItem('trip2026_shop'));
                    if(localStorage.getItem('trip2026_locs')) savedLocations.value = JSON.parse(localStorage.getItem('trip2026_locs'));
                });

                watch(tripDays, (v) => localStorage.setItem('trip2026_days', JSON.stringify(v)), { deep: true });
                watch(expenses, (v) => localStorage.setItem('trip2026_expenses', JSON.stringify(v)), { deep: true });
                watch(shoppingList, (v) => localStorage.setItem('trip2026_shop', JSON.stringify(v)), { deep: true });
                watch(savedLocations, (v) => localStorage.setItem('trip2026_locs', JSON.stringify(v)), { deep: true });
                watch(isDarkMode, (v) => localStorage.setItem('trip2026_theme', v));

                return {
                    isDarkMode, toggleTheme, currentTab, tabs, selectedDayIndex, tripDays, currentDay,
                    currentParkAreas, currentFacilityList, tempDisney, addDisneyEvent,
                    sortedEvents, showModal, newEvent, openEventModal, saveCustomEvent, deleteEvent,
                    expenses, newExpense, addOrUpdateExpense, editExpense, deleteExpense, isEditingExpense, cancelEditExpense,
                    shoppingList, newShoppingItem, addShoppingItem,
                    savedLocations, newLocation, addLocation, deleteLocation, openMap,
                    exchangeRate, totalSpending, toggleMap, getEmbedUrl,
                    showSettings, importString, exportData, importData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>

