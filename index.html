<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Êó•Êú¨ 2026 Ë°åÁ®ã App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* CSS Variables for Theme Switching */
        :root {
            --bg-color: #f0f2f5;
            --text-color: #4a5568;
            --card-bg: #e0e5ec;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --accent: #6b7c93;
            --input-bg: #e0e5ec;
        }

        [data-theme="dark"] {
            --bg-color: #292d32;
            --text-color: #a0a5a9;
            --card-bg: #292d32;
            --shadow-light: #32373d;
            --shadow-dark: #202327;
            --accent: #a0a5a9;
            --input-bg: #292d32;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans TC', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .neu-flat {
            background: var(--card-bg);
            box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }

        .neu-pressed {
            background: var(--card-bg);
            box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
            border-radius: 15px;
        }

        .neu-btn {
            background: var(--card-bg);
            box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
            transition: all 0.2s ease;
            color: var(--text-color);
            cursor: pointer;
        }

        .neu-btn:active, .neu-btn.active {
            box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
            transform: translateY(1px);
        }

        .neu-input {
            background: var(--input-bg);
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            border: none;
            color: var(--text-color);
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .neu-input:focus {
            outline: none;
            box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
        }

        .flight-line {
            border-top: 2px dashed var(--text-color);
            opacity: 0.3;
            position: absolute;
            top: 50%;
            left: 20%;
            right: 20%;
            z-index: 0;
        }

        .modal-overlay {
            background-color: rgba(0,0,0,0.75);
            backdrop-filter: blur(4px);
        }

        select {
            -webkit-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body class="h-screen overflow-hidden select-none">

    <div id="app" class="h-full flex flex-col max-w-md mx-auto relative transition-colors duration-300">
        
        <!-- Header -->
        <header class="p-6 pb-2 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold tracking-widest">TOKYO 2026</h1>
                <p class="text-xs opacity-70">JAN 26 - JAN 31</p>
            </div>
            <button @click="toggleTheme" class="neu-btn w-10 h-10 rounded-full flex items-center justify-center text-yellow-500">
                <i :class="isDarkMode ? 'fas fa-sun' : 'fas fa-moon'"></i>
            </button>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-5 pb-28 space-y-6">

            <!-- TAB 1: SCHEDULE -->
            <section v-if="currentTab === 'schedule'" class="space-y-6">
                
                <!-- Date Selector -->
                <div class="flex overflow-x-auto space-x-4 pb-4 px-1 hide-scrollbar">
                    <div v-for="(day, index) in tripDays" :key="index" 
                         @click="selectedDayIndex = index"
                         :class="['neu-btn px-5 py-3 rounded-2xl flex-shrink-0 text-center min-w-[90px]', selectedDayIndex === index ? 'active border border-blue-400' : '']">
                        <div class="text-xs font-bold opacity-70">{{ day.weekDay }}</div>
                        <div class="text-sm font-bold">{{ day.dateShort }}</div>
                    </div>
                </div>

                <!-- Hotel Info -->
                <div class="neu-pressed p-4 rounded-xl flex items-start gap-3">
                    <i class="fas fa-bed mt-1 opacity-50"></i>
                    <div class="w-full">
                        <input v-model="currentDay.hotel.name" placeholder="Ëº∏ÂÖ•ÈÖíÂ∫óÂêçÁ®±" class="bg-transparent w-full text-sm font-bold focus:outline-none text-[var(--text-color)]">
                        <input v-model="currentDay.hotel.address" placeholder="Ëº∏ÂÖ•ÈÖíÂ∫óÂú∞ÂùÄ..." class="bg-transparent w-full text-xs opacity-70 focus:outline-none text-[var(--text-color)]">
                    </div>
                </div>

                <!-- Weather -->
                <div class="neu-flat p-4 flex items-center justify-between">
                    <div>
                        <div class="text-xs opacity-50">È†êÊ∏¨Â§©Ê∞£ (ÈªûÊìä‰øÆÊîπ)</div>
                        <input v-model="currentDay.weather.temp" class="bg-transparent text-xl font-light w-16 focus:outline-none text-[var(--text-color)]">
                        <div class="text-xs opacity-70">{{ currentDay.location }}</div>
                    </div>
                    <select v-model="currentDay.weather.icon" class="bg-transparent text-3xl focus:outline-none text-right appearance-none">
                        <option>‚òÄÔ∏è</option><option>‚òÅÔ∏è</option><option>üåßÔ∏è</option><option>‚òÉÔ∏è</option>
                    </select>
                </div>

                <!-- Flight Card -->
                <div v-if="currentDay.flight" class="neu-flat p-5 relative overflow-hidden">
                    <div class="text-xs font-bold text-center mb-4 opacity-50 tracking-widest">FLIGHT INFO</div>
                    <div class="flex justify-between items-center relative z-10">
                        <div class="text-center">
                            <div class="text-2xl font-black">{{ currentDay.flight.from }}</div>
                            <div class="text-xs opacity-70">{{ currentDay.flight.fromTerminal }}</div>
                            <input type="time" v-model="currentDay.flight.depTime" class="bg-transparent text-xs mt-1 text-center w-full focus:outline-none text-[var(--text-color)]">
                        </div>
                        <i class="fas fa-plane text-xl opacity-50 transform rotate-90 sm:rotate-0"></i>
                        <div class="text-center">
                            <div class="text-2xl font-black">{{ currentDay.flight.to }}</div>
                            <div class="text-xs opacity-70">{{ currentDay.flight.toTerminal }}</div>
                            <input type="time" v-model="currentDay.flight.arrTime" class="bg-transparent text-xs mt-1 text-center w-full focus:outline-none text-[var(--text-color)]">
                        </div>
                    </div>
                    <div class="flight-line"></div>
                </div>

                <!-- Disney Planner (Expanded) -->
                <div v-if="currentDay.parkName" class="neu-flat p-5 space-y-4 border-l-4 border-purple-500">
                    <h3 class="text-sm font-bold text-purple-500 uppercase flex justify-between">
                        <span>üé° {{ currentDay.parkName === 'land' ? 'Disneyland' : 'DisneySea' }} Planner</span>
                    </h3>
                    
                    <!-- Time -->
                    <div class="grid grid-cols-2 gap-2">
                        <input type="time" v-model="tempDisney.start" class="neu-input p-2 text-xs text-center">
                        <input type="time" v-model="tempDisney.end" class="neu-input p-2 text-xs text-center">
                    </div>

                    <!-- 1. Area Selection -->
                    <select v-model="tempDisney.area" class="neu-input w-full p-3 text-sm">
                        <option value="" disabled selected>1. ÈÅ∏ÊìáÂçÄÂüü (Area)</option>
                        <option v-for="area in currentParkAreas" :key="area" :value="area">{{ area }}</option>
                    </select>

                    <!-- 2. Type Selection (Attraction/Food/Shop) -->
                    <select v-if="tempDisney.area" v-model="tempDisney.type" class="neu-input w-full p-3 text-sm">
                        <option value="" disabled selected>2. ÈÅ∏ÊìáÈ°ûÂà• (Type)</option>
                        <option value="attractions">üé¢ ÈÅäÊ®ÇË®≠ÊñΩ (Attractions)</option>
                        <option value="restaurants">üçΩÔ∏è È§êÂª≥ (Restaurants)</option>
                        <option value="shops">üõçÔ∏è ÂïÜÂ∫ó (Shops)</option>
                    </select>

                    <!-- 3. Specific Item Selection -->
                    <select v-if="tempDisney.type" v-model="tempDisney.facility" class="neu-input w-full p-3 text-sm">
                        <option value="" disabled selected>3. ÈÅ∏ÊìáÈ†ÖÁõÆ</option>
                        <option v-for="item in currentFacilityList" :key="item" :value="item">{{ item }}</option>
                    </select>
                    
                    <!-- 4. Notes -->
                    <input v-if="tempDisney.facility" v-model="tempDisney.note" placeholder="ÂÇôË®ª (e.g. ÊäΩPass / Ë≤∑È†≠ÁÆç)" class="neu-input w-full p-3 text-sm">

                    <button @click="addDisneyEvent" :disabled="!tempDisney.facility" class="neu-btn w-full py-3 rounded-xl text-sm font-bold text-purple-500">
                        + Âä†ÂÖ•Ë°åÁ®ã
                    </button>
                </div>

                <!-- Itinerary List -->
                <div class="space-y-4">
                    <div class="flex justify-between items-end">
                        <h3 class="text-sm font-bold ml-2 opacity-50">SCHEDULE</h3>
                        <button @click="openEventModal()" class="neu-btn px-3 py-1 text-xs rounded-lg">+ Ëá™Ë®ÇË°åÁ®ã</button>
                    </div>

                    <div v-for="(item, idx) in sortedEvents" :key="idx" class="neu-flat p-4 relative group">
                        <button @click="deleteEvent(idx)" class="absolute top-2 right-2 text-xs opacity-30 hover:opacity-100 text-red-500 p-2">‚úï</button>

                        <div class="flex gap-4">
                            <div class="flex flex-col items-center min-w-[60px]">
                                <div class="text-xs font-mono opacity-70">{{ item.startTime || '--:--' }}</div>
                                <div class="text-xs opacity-30">|</div>
                                <div class="text-xs font-mono opacity-70">{{ item.endTime || '' }}</div>
                            </div>
                            <div class="flex-1">
                                <div class="font-bold text-sm">{{ item.title }}</div>
                                <div class="text-xs opacity-70 mt-1 whitespace-pre-line">{{ item.desc }}</div>
                                <div v-if="item.note" class="text-xs text-purple-400 mt-1 bg-purple-500/10 p-1 rounded inline-block">üìù {{ item.note }}</div>
                                
                                <div v-if="item.address || item.mapLink" class="mt-3 pt-2 border-t border-gray-500/20 flex gap-2 overflow-x-auto">
                                    <button v-if="item.mapLink" @click="toggleMap(idx)" class="neu-btn px-2 py-1 text-[10px] rounded flex items-center gap-1 whitespace-nowrap">
                                        <i class="fas fa-map"></i> {{ item.showMap ? 'Èö±Ëóè' : 'Âú∞Âúñ' }}
                                    </button>
                                    <a v-if="item.mapLink" :href="item.mapLink" target="_blank" class="neu-btn px-2 py-1 text-[10px] rounded flex items-center gap-1 whitespace-nowrap text-blue-500">
                                        <i class="fas fa-location-arrow"></i> Â∞éËà™
                                    </a>
                                </div>
                                <iframe v-if="item.showMap && item.mapLink" class="w-full h-40 mt-2 rounded-lg opacity-80" frameborder="0" style="border:0" :src="getEmbedUrl(item.mapLink)"></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB 2: MONEY -->
            <section v-if="currentTab === 'money'" class="space-y-6">
                <!-- (Keep Money Section Logic Same as Before, omitted for brevity but included in full code logic below) -->
                 <div class="neu-flat p-6 text-center">
                    <div class="text-xs opacity-50 mb-1">Á∏ΩÊîØÂá∫ (TOTAL)</div>
                    <div class="text-3xl font-light">¬• {{ totalSpending.toLocaleString() }}</div>
                    <div class="text-sm opacity-50 mt-1">‚âà HK$ {{ (totalSpending * exchangeRate).toFixed(1) }}</div>
                </div>
                <div class="neu-flat p-5 space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-[10px] ml-1 opacity-50">ÈáëÈ°ç</label><input type="number" v-model="newExpense.amount" class="neu-input w-full p-3 text-lg font-mono"></div>
                        <div class="flex items-end pb-3 pl-2"><span class="text-sm opacity-50">‚âà HK$ {{ (newExpense.amount * exchangeRate).toFixed(1) }}</span></div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div><label class="text-[10px] ml-1 opacity-50">È†ÖÁõÆ</label><input type="text" v-model="newExpense.item" class="neu-input w-full p-3 text-sm"></div>
                        <div><label class="text-[10px] ml-1 opacity-50">ÊîØ‰ªò</label><select v-model="newExpense.method" class="neu-input w-full p-3 text-sm"><option value="cash">ÁèæÈáë</option><option value="card">‰ø°Áî®Âç°</option><option value="suica">Suica</option></select></div>
                    </div>
                    <button @click="addOrUpdateExpense" class="neu-btn w-full py-3 rounded-xl text-sm font-bold text-green-600">{{ isEditingExpense ? '‰øÆÊîπ' : 'Ë®òÂ∏≥' }}</button>
                    <button v-if="isEditingExpense" @click="cancelEditExpense" class="text-xs w-full text-center opacity-50">ÂèñÊ∂à</button>
                </div>
                <div class="space-y-3 pb-10">
                    <div v-for="(exp, i) in expenses" :key="exp.id" class="neu-pressed p-4 flex justify-between items-center group relative">
                        <div><div class="text-sm font-bold">{{ exp.item }}</div><div class="text-xs opacity-50 uppercase">{{ exp.method }}</div></div>
                        <div class="text-right mr-6"><div class="text-sm font-mono">¬•{{ Number(exp.amount).toLocaleString() }}</div></div>
                        <div class="absolute right-2 flex flex-col gap-2">
                            <button @click="deleteExpense(exp.id)" class="text-red-400 opacity-50"><i class="fas fa-trash text-xs"></i></button>
                            <button @click="editExpense(exp.id)" class="text-blue-400 opacity-50"><i class="fas fa-pen text-xs"></i></button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB 3 & 4 (Map / Shopping) same structure -->
            <section v-if="currentTab === 'map'" class="space-y-4">
                 <div class="neu-flat p-4 space-y-3">
                    <h3 class="text-sm font-bold opacity-50">Êñ∞Â¢ûÂú∞Èªû</h3>
                    <input v-model="newLocation.name" placeholder="Âú∞ÈªûÂêçÁ®±" class="neu-input w-full p-2 text-sm">
                    <input v-model="newLocation.url" placeholder="Google Maps URL" class="neu-input w-full p-2 text-sm">
                    <button @click="addLocation" class="neu-btn w-full py-2 rounded-lg text-sm">ÂÑ≤Â≠òÂú∞Èªû</button>
                </div>
                <div class="space-y-2">
                    <div v-for="(loc, idx) in savedLocations" :key="idx" class="neu-btn p-4 rounded-xl flex justify-between items-center">
                        <div @click="openMap(loc.url)" class="flex-1"><div class="text-sm font-bold">{{ loc.name }}</div></div>
                        <div class="flex gap-3"><button @click="loc.showEmbed = !loc.showEmbed" class="opacity-50"><i class="fas fa-eye"></i></button><button @click="deleteLocation(idx)" class="text-red-400 opacity-50"><i class="fas fa-trash"></i></button></div>
                        <div v-if="loc.showEmbed" class="w-full mt-2 absolute left-0 px-4 z-20"><iframe class="w-full h-40 rounded-lg shadow-xl" :src="getEmbedUrl(loc.url)"></iframe></div>
                    </div>
                </div>
            </section>

             <section v-if="currentTab === 'shopping'" class="space-y-6">
                <div class="neu-flat p-5 space-y-4"><div class="flex gap-2"><input type="text" v-model="newShoppingItem" class="neu-input flex-1 p-3 text-sm"><button @click="addShoppingItem" class="neu-btn px-4 rounded-xl text-xl">+</button></div></div>
                <div class="space-y-2"><div v-for="(item, i) in shoppingList" :key="i" class="neu-btn p-4 rounded-xl flex items-center justify-between"><div class="flex items-center gap-3 flex-1" @click="item.bought = !item.bought"><div :class="['w-5 h-5 rounded-full border-2 border-gray-500 flex items-center justify-center', item.bought ? 'bg-gray-500' : '']"><i v-if="item.bought" class="fas fa-check text-[10px] text-white"></i></div><span :class="['text-sm', item.bought ? 'line-through opacity-50' : '']">{{ item.name }}</span></div><button @click="shoppingList.splice(i, 1)" class="opacity-20 text-red-500 p-2">‚úï</button></div></div>
            </section>
        </main>

        <!-- Nav & Modal (Same) -->
        <nav class="absolute bottom-6 left-6 right-6 h-16 neu-flat flex justify-around items-center px-2 z-50 rounded-2xl">
            <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id" :class="['p-3 rounded-xl transition', currentTab === tab.id ? 'text-blue-400 transform scale-110' : 'opacity-50']"><i :class="tab.icon + ' text-xl'"></i></button>
        </nav>
        
        <div v-if="showModal" class="fixed inset-0 modal-overlay z-[60] flex items-center justify-center p-4">
            <div class="neu-flat w-full max-w-sm p-6 space-y-4 bg-[var(--card-bg)]">
                <h3 class="font-bold text-lg">Ëá™Ë®ÇË°åÁ®ã</h3>
                <div class="flex gap-2"><input type="time" v-model="newEvent.startTime" class="neu-input p-2 flex-1"><input type="time" v-model="newEvent.endTime" class="neu-input p-2 flex-1"></div>
                <input v-model="newEvent.title" placeholder="Ê®ôÈ°å" class="neu-input w-full p-2">
                <textarea v-model="newEvent.desc" placeholder="Ë©≥ÊÉÖ" class="neu-input w-full p-2 h-20"></textarea>
                <input v-model="newEvent.note" placeholder="ÂÇôË®ª (Á¥´Ëâ≤Ê®ôÁ±§)" class="neu-input w-full p-2 text-xs">
                <input v-model="newEvent.mapLink" placeholder="Maps Link" class="neu-input w-full p-2 text-xs">
                <div class="flex gap-3 pt-2"><button @click="saveCustomEvent" class="neu-btn flex-1 py-2 rounded-lg font-bold text-blue-500">ÂÑ≤Â≠ò</button><button @click="showModal = false" class="neu-btn flex-1 py-2 rounded-lg text-red-400">ÂèñÊ∂à</button></div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;

        // Expanded Disney Data Source
        const disneyDB = {
            land: {
                "World Bazaar": {
                    attractions: ["Omnibus (ÈõôÂ±§Â∑¥Â£´)", "Penny Arcade (‰æøÂ£´Êã±Âªä)"],
                    restaurants: ["Eastside Cafe (Êù±Ë°óÂíñÂï°È§êÈ§®)", "Center Street Coffeehouse (‰∏≠Â§ÆÂ§ßÈÅìÂíñÂï°È§êÈ§®)", "Great American Waffle Co. (ÊúÄ‰Ω≥ÁæéÂúãÈ¨ÜÈ§ÖÂÖ¨Âè∏)", "Restaurant Hokusai (ÂåóÈΩãÈ§êÂª≥)", "Sweetheart Cafe (ÁîúÂøÉÂíñÂï°È§êÈ§®)"],
                    shops: ["Grand Emporium (Ê†ºËò≠ÊÅ©Ê≥¢ÂïÜÂ†¥)", "World Bazaar Confectionery (‰∏ñÁïåÂ∏ÇÈõÜÈªûÂøÉÂùä)", "House of Greetings (Ëá¥Ë≥ÄÂ±ã)"]
                },
                "Adventureland": {
                    attractions: ["Pirates of the Caribbean (Âä†ÂãíÊØîÊµ∑Áõú)", "Jungle Cruise (Âè¢ÊûóÂ∑°Ëà™)", "Western River Railroad (Ë•øÈÉ®Ê≤øÊ≤≥ÈêµË∑Ø)", "The Enchanted Tiki Room (ÊèêÂü∫Á•ûÊÆø)"],
                    restaurants: ["Blue Bayou Restaurant (ËóçÊµ∑ÁÅ£È§êÂª≥)", "Crystal Palace Restaurant (Ê∞¥Êô∂ÂÆÆÈ§êÂª≥)", "Polynesian Terrace (Ê≥¢Âà©Â∞ºË•ø‰∫ûËçâÂ£áÈ§êÂª≥)", "China Voyager (‰∏≠ËèØÈ§êÂª≥)", "Cafe Orleans (Â•ßÁàæËâØÂíñÂï°)"],
                    shops: ["Adventureland Bazaar (Êé¢Èö™Ê®ÇÂúíÂ∏ÇÈõÜ)", "Le Marche Bleu (ËóçËâ≤Â∏ÇÈõÜ)", "Cristal Arts (Ê∞¥Êô∂ËóùË°ì)"]
                },
                "Westernland": {
                    attractions: ["Big Thunder Mountain (Â∑®Èõ∑Â±±)", "Country Bear Theater (ÈÑâÊùëÈ†ëÁÜäÂäáÂ†¥)", "Mark Twain Riverboat (È¶¨ÂÖãÂêêÊ∫´Ëôü)", "Tom Sawyer Island (ÊπØÂßÜÁ¥¢‰∫ûÂ≥∂)"],
                    restaurants: ["Hungry Bear Restaurant (È†ëÁÜäÈ§êÂª≥)", "Plaza Pavilion Restaurant (Âª£Â†¥Ê®ìÈñ£È§êÂª≥)", "Pecos Bill Cafe (‰Ω©ÊñØÊØîÁàæÂ∞èÈ§®)", "Camp Woodchuck Kitchen (ÂúüÊí•Èº†ÁáüÂú∞ÂªöÊàø)"],
                    shops: ["Western Wear (Ë•øÈÉ®ÊúçË£ù)", "General Store (ÈõúË≤®Â∫ó)"]
                },
                "Critter Country": {
                    attractions: ["Splash Mountain (È£õÊø∫Â±±)", "Beaver Brothers Explorer Canoes (Êµ∑Ë≤çÂÖÑÂºüÁç®Êú®Ëàü)"],
                    restaurants: ["Grandma Sara's Kitchen (ËééÊãâÈòøÂ•∂Â•∂ÁöÑÂªöÊàø)", "Rackety's Raccoon Saloon (ÊãâÂêâËíÇÊµ£ÁÜäÂ∞èÁ´ô)"],
                    shops: ["Hoot & Holler Hideout (ÂëºÂóí¬∑Ëµ´ÂãíÁ™©)"]
                },
                "Fantasyland": {
                    attractions: ["Enchanted Tale of Beauty and the Beast (ÁæéÂ•≥ËàáÈáéÁç∏)", "Pooh's Hunny Hunt (Â∞èÁÜäÁ∂≠Â∞ºÁçµËúúË®ò)", "Haunted Mansion (ÂπΩÈùàÂÖ¨È§®)", "It's a Small World (Â∞èÂ∞è‰∏ñÁïå)", "Peter Pan's Flight (ÂΩºÂæóÊΩò)", "Pinocchio's Daring Journey (Â∞èÊú®ÂÅ∂Â•áÈÅáË®ò)", "Snow White's Adventures (ÁôΩÈõ™ÂÖ¨‰∏ªÂÜíÈö™ÊóÖÁ®ã)", "Dumbo (Â∞èÈ£õË±°)", "Cinderella's Fairy Tale Hall (‰ªôÂ±•Â•áÁ∑£Á´•Ë©±Â§ßÂª≥)"],
                    restaurants: ["Queen of Hearts Banquet Hall (Á¥ÖÂøÉÂ•≥ÁéãÂÆ¥ÊúÉÂ§ßÂª≥)", "La Taverne de Gaston (Âä†ÊñØÈ†ìÈÖíÈ§®)", "Captain Hook's Galley (ËôéÂÖãËàπÈï∑ÁöÑÂªöÊàø)", "Village Pastry (ÈÑâÊùëÁ≥ïÈªû)"],
                    shops: ["Village Shoppes (ÈÑâÊùëÂïÜÂ∫ó)", "Kingdom Treasures (ÁéãÂúãÂØ∂Ëóè)", "Pooh Corner (Â∞èÁÜäÁ∂≠Â∞ºÂ∞àÊ´É)"]
                },
                "Toontown": {
                    attractions: ["Roger Rabbit's Car Toon Spin (ÁæÖÂÇëÂÖîÂ≠êËΩâËΩâËªä)", "Minnie's Style Studio (Á±≥Â¶ÆÊôÇÂ∞öÂ∑•‰ΩúÂÆ§)", "Gadget's Go Coaster (ËâæËäùËø∑‰Ω†Èõ≤ÈúÑÈ£õËªä)"],
                    restaurants: ["Huey, Dewey and Louie's Good Time Cafe (ËºùÂÖíÊùúÂÖíË∑ØÂÖíÂ•ΩÊôÇÂÖâÂíñÂï°)", "Toontone Treats (Âç°ÈÄöÊºÜÂΩ©ÈªûÂøÉ)"],
                    shops: ["Gag Factory (ÊªëÁ®ΩÂ∑•Âª†)"]
                },
                "Tomorrowland": {
                    attractions: ["Space Mountain (Â§™Á©∫Â±±)", "Star Tours (ÊòüÈöõÊóÖË°å)", "Monsters, Inc. Ride & Go Seek! (ÊÄ™Áç∏ÈõªÂäõÂÖ¨Âè∏)", "Baymax Happy Ride (ÊùØÈ∫µÊ≠°Ê®ÇÊê≠)", "Buzz Lightyear's Astro Blasters (Â∑¥ÊñØÂÖâÂπ¥ÊòüÈöõÊ≠∑Èö™)"],
                    restaurants: ["Pan Galactic Pizza Port (Ê±éÈäÄÊ≤≥Êä´Ëñ©Ê∏Ø)", "Plazma Ray's Diner (ÁëûÊñØÁë™Â∞ÑÁ∑öÂø´È§ê)", "The Big Pop (ÈúπÈùÇÂï™Âï¶ÁàÜÁ±≥Ëä±)"],
                    shops: ["Planet M (Ë°åÊòüM)", "Cosmic Encounter (ÂÆáÂÆôÁõ∏ÈÅá)"]
                }
            },
            sea: {
                "Fantasy Springs": {
                    attractions: ["Anna and Elsa's Frozen Journey (ÂÆâÂ®úËàáËâæËééÁöÑÂÜ∞Èõ™‰πãÊóÖ)", "Rapunzel's Lantern Festival (Ê®Ç‰Ω©ÂÖ¨‰∏ªÂ§©ÁáàÁõõÊúÉ)", "Peter Pan's Never Land Adventure (ÂΩºÂæóÊΩòÂ§¢ÂπªÂ≥∂Ê≠∑Èö™Ë®ò)", "Fairy Tinker Bell's Busy Buggies (Â•áÂ¶ô‰ªôÂ≠êÂ¶ôÂ¶ôËªä)"],
                    restaurants: ["Royal Banquet of Arendelle (ËâæÂÄ´Êà¥ÁàæÁöáÂÆ∂ÂÆ¥ÊúÉÂª≥)", "The Snuggly Duckling (ÈÜúÂ∞èÈ¥®Â∞èÈ§®)", "Lookout Cookout (Áû≠ÊúõËá∫ÈáéÈ§êÂ±ã)"],
                    shops: ["Fantasy Springs Gifts (Â§¢ÂπªÊ≥âÈÑâÁ¶ÆÂìÅ)"]
                },
                "Mediterranean Harbor": {
                    attractions: ["Soaring: Fantastic Flight (Áø±ÁøîÔºöÂ§¢ÂπªÂ•áËà™)", "DisneySea Transit Steamer Line (Ëø™Â£´Â∞ºÊµ∑Ê¥ãÊ∏°Ëº™)", "Fortress Explorations (Ë¶ÅÂ°ûÊé¢Èö™)", "Venetian Gondolas (Â®ÅÂ∞ºÊñØË≤¢Â§öÊãâÈÅäËàπ)"],
                    restaurants: ["Magellan's (È∫•Âì≤ÂÄ´)", "Ristorante di Canaletto (Âç°Á¥çÈõ∑ÊâòÈ§êÂª≥)", "Zambini Brothers' Ristorante (Â∞öÊØîÂ∞ºÂÖÑÂºüÈ§êÂª≥)", "Cafe Portofino (Ê≥¢Â§öËè≤Ë´æÂíñÂï°)"],
                    shops: ["Emporio (ÊÅ©Ê≥¢Âà©Ê≠ê)", "Il Postino Stationery (ÈÉµÂ±ÄÊñáÂÖ∑Â∫ó)"]
                },
                "American Waterfront": {
                    attractions: ["Tower of Terror (È©öÈ≠ÇÂè§Â°î)", "Toy Story Mania! (Áé©ÂÖ∑Á∏ΩÂãïÂì°ÁòãÁãÇÈÅäÊà≤Â±ã)", "Turtle Talk (ÈæúÈæúÊº´Ë´á)", "Big City Vehicles (Â§ßÈÉΩÊúÉ‰∫§ÈÄöÂ∑•ÂÖ∑)"],
                    restaurants: ["S.S. Columbia Dining Room (S.S.Âì•ÂÄ´ÊØî‰∫ûÈ§êÂª≥)", "Teddy Roosevelt Lounge (Ê≥∞Ëø™ÁæÖÊñØÁ¶èÊ≠°ËÖæ)", "New York Deli (Á¥êÁ¥ÑÁæéÂë≥Êàø)", "Cape Cod Cook-Off (È±àÈ≠öÂ≤¨Èå¶Ê®ôÁæéÈ£ü)"],
                    shops: ["McDuck's Department Store (Âè≤È´òÊ≤ªÁôæË≤®ÂÖ¨Âè∏)", "Steamboat Mickey's (Ëí∏Ê∞£ËàπÁ±≥Â•á)"]
                },
                "Port Discovery": {
                    attractions: ["Nemo & Friends SeaRider (Â∞ºËé´&Â•ΩÂèãÁöÑÊµ∑Ê¥ã‰∏ñÁïå)", "Aquatopia (Ê∞¥‰∏äÈÄóË∂£Ëàπ)"],
                    restaurants: ["Horizon Bay Restaurant (Ê∞¥Âπ≥Á∑öÊµ∑ÁÅ£È§êÂª≥)", "Seaside Snacks (Êµ∑ÈÇäÂ∞èÂêÉ)"],
                    shops: ["Discovery Gifts (ÁôºÁèæÁ¶ÆÂìÅ)"]
                },
                "Lost River Delta": {
                    attractions: ["Indiana Jones Adventure (Âç∞Á¨¨ÂÆâÁ¥çÁìäÊñØÂÜíÈö™ÊóÖÁ®ã)", "Raging Spirits (ÂøøÊÄíÈõôÁ•û)"],
                    restaurants: ["Yucatan Base Camp Grill (Áå∂Âä†Êï¶Âü∫Âú∞ÁáüÁáíÁÉ§)", "Miguel's El Dorado Cantina (Á±≥Ê†ºÂãíÈªÉÈáëÂúãÂø´È§êÂ∫ó)"],
                    shops: ["Lost River Outfitters (Â§±ËêΩÊ≤≥Êé¢Èö™Áî®ÂìÅ)"]
                },
                "Arabian Coast": {
                    attractions: ["Sinbad's Storybook Voyage (ËæõÂ∑¥ÈÅîÂÇ≥Â•á‰πãÊóÖ)", "The Magic Lamp Theater (Á•ûÁáàÂäáÂ†¥)", "Jasmine's Flying Carpets (ËåâËéâÂÖ¨‰∏ªÁöÑÈ£õÂ§©È≠îÊØØ)", "Caravan Carousel (Ê≤ôÊº†ÂïÜÈöäÊóãËΩâÊú®È¶¨)"],
                    restaurants: ["Casbah Food Court (Âç°ÊñØÂ∑¥ÁæéÈ£üÂª£Â†¥)", "Sultan's Oasis (Ëòá‰∏πÁ∂†Ê¥≤)"],
                    shops: ["Agrabah Marketplace (ÈòøÊ†ºÊãâÂ∑¥Â∏ÇÂ†¥)"]
                },
                "Mermaid Lagoon": {
                    attractions: ["Mermaid Lagoon Theater (Áæé‰∫∫È≠öÁ§ÅÊπñÂäáÂ†¥)", "Flounder's Flying Fish Coaster (Â∞èËÉñÁöÑÈ£õÈ≠öÈõ≤ÈúÑÈ£õËªä)", "Scuttle's Scooters (Âè≤Âç°ÊâòÁöÑÂØÑÂ±ÖËüπ)", "Jumpin' Jellyfish (Ë∑≥Ë∫çÊ∞¥ÊØç)", "Blowfish Balloon Race (Ê≤≥Ë±öÊ∞£ÁêÉÁ´∂Ë≥Ω)", "The Whirlpool (ÊóãËΩâÊµ∑ËóªÊùØ)"],
                    restaurants: ["Sebastian's Calypso Kitchen (Ë≥ΩÂ∑¥ÊñØ‰∏ÅÂä†ÂäõÈ™öÂªöÊàø)"],
                    shops: ["Sleepy Whale Shoppe (Áù°ÈØ®ÂïÜÂ∫ó)", "Kiss de Girl Fashions (Âêª‰πãÂ•≥Â≠©ÊúçÈ£æ)"]
                },
                "Mysterious Island": {
                    attractions: ["Journey to the Center of the Earth (Âú∞ÂøÉÊé¢Èö™‰πãÊóÖ)", "20,000 Leagues Under the Sea (Êµ∑Â∫ïÂÖ©Ëê¨Âì©)"],
                    restaurants: ["Vulcania Restaurant (ÁÅ´Â±±È§êÂª≥)", "Nautilus Galley (È∏öÈµ°Ëû∫ËôüÂ§ßÈ£üÂ†Ç)"],
                    shops: ["Nautilus Gifts (È∏öÈµ°Ëû∫ËôüÁ¶ÆÂìÅ)"]
                }
            }
        };

        createApp({
            setup() {
                // --- Core State ---
                const isDarkMode = ref(true);
                const currentTab = ref('schedule');
                const selectedDayIndex = ref(0);
                const exchangeRate = 0.052;
                const showModal = ref(false);
                
                // --- Data Structure ---
                const tripDays = ref([
                    { date: '2026-01-26', dateShort: '1/26', weekDay: 'Mon', location: 'È¶ôÊ∏Ø -> Êù±‰∫¨', parkName: null, 
                      weather: { temp: '8¬∞C', icon: 'üåô' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      flight: { from: 'HKG', fromTerminal: 'T1', to: 'NRT', toTerminal: 'T2', depTime: '09:00', arrTime: '14:00' },
                      events: [] },
                    { date: '2026-01-27', dateShort: '1/27', weekDay: 'Tue', location: 'Tokyo Disneyland', parkName: 'land', 
                      weather: { temp: '6¬∞C', icon: '‚òÄÔ∏è' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      events: [] },
                    { date: '2026-01-28', dateShort: '1/28', weekDay: 'Wed', location: 'Tokyo DisneySea', parkName: 'sea', 
                      weather: { temp: '5¬∞C', icon: '‚òÅÔ∏è' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      events: [] },
                    { date: '2026-01-29', dateShort: '1/29', weekDay: 'Thu', location: 'Tokyo DisneySea', parkName: 'sea', 
                      weather: { temp: '4¬∞C', icon: 'üåßÔ∏è' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      events: [] },
                    { date: '2026-01-30', dateShort: '1/30', weekDay: 'Fri', location: 'Tokyo City', parkName: null, 
                      weather: { temp: '7¬∞C', icon: 'üå§Ô∏è' }, 
                      hotel: { name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', address: '1-19-1 Kabukicho' },
                      events: [] },
                    { date: '2026-01-31', dateShort: '1/31', weekDay: 'Sat', location: 'Êù±‰∫¨ -> È¶ôÊ∏Ø', parkName: null, 
                      weather: { temp: '9¬∞C', icon: '‚òÄÔ∏è' }, 
                      hotel: { name: '', address: '' },
                      flight: { from: 'NRT', fromTerminal: 'T2', to: 'HKG', toTerminal: 'T1', depTime: '18:00', arrTime: '22:30' },
                      events: [] },
                ]);

                const tempDisney = ref({ start: '', end: '', area: '', type: '', facility: '', note: '' });
                const newEvent = ref({ startTime: '', endTime: '', title: '', desc: '', note: '', mapLink: '' });
                const expenses = ref([]);
                const newExpense = ref({ id: null, amount: '', method: 'cash', item: '' });
                const isEditingExpense = ref(false);
                const shoppingList = ref([{ name: 'Ëó•Â¶ùÂ∫óÈù¢ËÜú', bought: false }]);
                const newShoppingItem = ref('');
                const savedLocations = ref([{ name: 'Êñ∞ÂÆøÊ†ºÊãâÊñØÈ∫óÈÖíÂ∫ó', url: 'https://goo.gl/maps/example', showEmbed: false }]);
                const newLocation = ref({ name: '', url: '' });

                const tabs = [
                    {id: 'schedule', icon: 'fas fa-calendar-alt'},
                    {id: 'map', icon: 'fas fa-map-marked'},
                    {id: 'money', icon: 'fas fa-wallet'},
                    {id: 'shopping', icon: 'fas fa-shopping-bag'}
                ];

                // --- Computed ---
                const currentDay = computed(() => tripDays.value[selectedDayIndex.value]);
                
                const currentParkAreas = computed(() => {
                    if (!currentDay.value.parkName) return [];
                    return Object.keys(disneyDB[currentDay.value.parkName]);
                });

                const currentFacilityList = computed(() => {
                    if (!tempDisney.value.area || !tempDisney.value.type) return [];
                    return disneyDB[currentDay.value.parkName][tempDisney.value.area][tempDisney.value.type] || [];
                });

                const sortedEvents = computed(() => {
                    return [...currentDay.value.events].sort((a, b) => (a.startTime || '24:00').localeCompare(b.startTime || '24:00'));
                });

                const totalSpending = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));

                // --- Methods ---
                const toggleTheme = () => {
                    isDarkMode.value = !isDarkMode.value;
                    document.documentElement.setAttribute('data-theme', isDarkMode.value ? 'dark' : 'light');
                };

                const addDisneyEvent = () => {
                    if (!tempDisney.value.facility) return;
                    currentDay.value.events.push({
                        startTime: tempDisney.value.start,
                        endTime: tempDisney.value.end,
                        title: tempDisney.value.facility,
                        desc: `${tempDisney.value.area} - ${tempDisney.value.type}`,
                        note: tempDisney.value.note,
                        showMap: false
                    });
                    tempDisney.value = { start: '', end: '', area: '', type: '', facility: '', note: '' };
                };

                const openEventModal = () => {
                    newEvent.value = { startTime: '', endTime: '', title: '', desc: '', note: '', mapLink: '' };
                    showModal.value = true;
                };

                const saveCustomEvent = () => {
                    if(!newEvent.value.title) return;
                    currentDay.value.events.push({ ...newEvent.value, showMap: false });
                    showModal.value = false;
                };

                const deleteEvent = (index) => {
                    if(confirm('Âà™Èô§Ê≠§Ë°åÁ®ã?')) currentDay.value.events.splice(index, 1);
                };

                const getEmbedUrl = (url) => `https://maps.google.com/maps?q=${encodeURIComponent(url)}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
                const toggleMap = (idx) => sortedEvents.value[idx].showMap = !sortedEvents.value[idx].showMap;

                const addOrUpdateExpense = () => {
                    if (!newExpense.value.amount || !newExpense.value.item) return;
                    if (isEditingExpense.value) {
                        const idx = expenses.value.findIndex(e => e.id === newExpense.value.id);
                        if(idx !== -1) expenses.value[idx] = { ...newExpense.value };
                        isEditingExpense.value = false;
                    } else {
                        expenses.value.unshift({ ...newExpense.value, id: Date.now() });
                    }
                    newExpense.value = { id: null, amount: '', method: 'cash', item: '' };
                };

                const editExpense = (id) => {
                    const exp = expenses.value.find(e => e.id === id);
                    if(exp) { newExpense.value = { ...exp }; isEditingExpense.value = true; }
                };

                const deleteExpense = (id) => { if(confirm('Âà™Èô§?')) expenses.value = expenses.value.filter(e => e.id !== id); };
                const cancelEditExpense = () => { isEditingExpense.value = false; newExpense.value = { id: null, amount: '', method: 'cash', item: '' }; };
                
                const addShoppingItem = () => { if(newShoppingItem.value) { shoppingList.value.push({ name: newShoppingItem.value, bought: false }); newShoppingItem.value = ''; }};
                const addLocation = () => { if(newLocation.value.name && newLocation.value.url) { savedLocations.value.push({ ...newLocation.value, showEmbed: false }); newLocation.value = { name: '', url: '' }; }};
                const deleteLocation = (i) => savedLocations.value.splice(i, 1);
                const openMap = (url) => window.open(url, '_blank');

                onMounted(() => {
                    document.documentElement.setAttribute('data-theme', isDarkMode.value ? 'dark' : 'light');
                    if(localStorage.getItem('trip2026_days')) tripDays.value = JSON.parse(localStorage.getItem('trip2026_days'));
                    if(localStorage.getItem('trip2026_expenses')) expenses.value = JSON.parse(localStorage.getItem('trip2026_expenses'));
                    if(localStorage.getItem('trip2026_shop')) shoppingList.value = JSON.parse(localStorage.getItem('trip2026_shop'));
                    if(localStorage.getItem('trip2026_locs')) savedLocations.value = JSON.parse(localStorage.getItem('trip2026_locs'));
                });

                watch(tripDays, (v) => localStorage.setItem('trip2026_days', JSON.stringify(v)), { deep: true });
                watch(expenses, (v) => localStorage.setItem('trip2026_expenses', JSON.stringify(v)), { deep: true });
                watch(shoppingList, (v) => localStorage.setItem('trip2026_shop', JSON.stringify(v)), { deep: true });
                watch(savedLocations, (v) => localStorage.setItem('trip2026_locs', JSON.stringify(v)), { deep: true });
                watch(isDarkMode, (v) => localStorage.setItem('trip2026_theme', v));

                return {
                    isDarkMode, toggleTheme, currentTab, tabs, selectedDayIndex, tripDays, currentDay,
                    currentParkAreas, currentFacilityList, tempDisney, addDisneyEvent,
                    sortedEvents, showModal, newEvent, openEventModal, saveCustomEvent, deleteEvent,
                    expenses, newExpense, addOrUpdateExpense, editExpense, deleteExpense, isEditingExpense, cancelEditExpense,
                    shoppingList, newShoppingItem, addShoppingItem,
                    savedLocations, newLocation, addLocation, deleteLocation, openMap,
                    exchangeRate, totalSpending, toggleMap, getEmbedUrl
                };
            }
        }).mount('#app');
    </script>
</body>
</html>

